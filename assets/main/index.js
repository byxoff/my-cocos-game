System.register("chunks:///_virtual/BoostController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(o){var i,t,n,e,a,r,s,l,c,f,u,h,b;return{setters:[function(o){i=o.applyDecoratedDescriptor,t=o.inheritsLoose,n=o.initializerDefineProperty,e=o.assertThisInitialized},function(o){a=o.cclegacy,r=o._decorator,s=o.Label,l=o.Vec3,c=o.Node,f=o.Color,u=o.tween,h=o.Component},function(o){b=o.SocketManager}],execute:function(){var p,g,d,L,v,w,y,m,C;a._RF.push({},"56fbbewdwxJOIoAGHAh8WY0","BoostController",void 0);var k=r.ccclass,B=r.property;o("BoostController",(p=k("BoostController"),g=B(b),d=B(s),p((w=i((v=function(o){function i(){for(var i,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return i=o.call.apply(o,[this].concat(a))||this,n(i,"socketManager",w,e(i)),n(i,"notificationLabel",y,e(i)),n(i,"animationDuration",m,e(i)),n(i,"moveUpDistance",C,e(i)),i.initialPosition=new l,i}t(i,o);var a=i.prototype;return a.onLoad=function(){this.node.on(c.EventType.TOUCH_END,this.onBoostClicked,this),this.notificationLabel?(this.notificationLabel.node.active=!1,this.initialPosition=this.notificationLabel.node.position.clone()):console.error("notificationLabel не назначен в BoostController.")},a.onBoostClicked=function(o){if(this.socketManager){var i=this.socketManager.getCurrentEnergy();if(this.socketManager.getCurrentBoosts()<=0)return this.showNotification("Бустеры кончились!"),void console.log("No boosts left.");if(i>=300)return this.showNotification("Слишком много энергии!"),void console.log("Energy is 300 or more, boost not activated.");this.socketManager.activateBoost(),this.showNotification("Энергия восстановлена!")}else console.warn("SocketManager is not assigned in BoostController.")},a.showNotification=function(o){var i=this;this.notificationLabel?(this.notificationLabel.string=o,this.notificationLabel.node.active=!0,this.notificationLabel.color=new f(255,255,255,255),this.notificationLabel.node.setPosition(this.initialPosition.clone()),u(this.notificationLabel).to(this.animationDuration,{color:new f(255,255,255,0)}).start(),u(this.notificationLabel.node).by(this.animationDuration,{position:new l(0,this.moveUpDistance,0)}).call((function(){i.notificationLabel.node.active=!1,i.notificationLabel.color=new f(255,255,255,255),i.notificationLabel.node.setPosition(i.initialPosition.clone())})).start()):console.warn("notificationLabel is not assigned in BoostController.")},i}(h)).prototype,"socketManager",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(v.prototype,"notificationLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(v.prototype,"animationDuration",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),C=i(v.prototype,"moveUpDistance",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),L=v))||L));a._RF.pop()}}}));

System.register("chunks:///_virtual/BoosterModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BoosterScrollView.ts","./SocketManager.ts"],(function(e){var t,n,i,o,r,s,a,l,c,u,b,h,p,m,d,g,f,v,S,L;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){a=e.cclegacy,l=e._decorator,c=e.Label,u=e.Node,b=e.Sprite,h=e.SpriteFrame,p=e.Animation,m=e.BlockInputEvents,d=e.UITransform,g=e.Button,f=e.Color,v=e.Component},function(e){S=e.BoosterScrollView},function(e){L=e.SocketManager}],execute:function(){var y,x,w,M,C,_,I,k,B,N,z,E,A,F,P,T,U,V,D,H,R,j,K,O,q,G,J,Q,Y,W,X,Z,$;a._RF.push({},"1eb8b6/gslMqpbC1Qen7aCJ","BoosterModal",void 0);var ee=l.ccclass,te=l.property;e("BoosterModal",(y=ee("BoosterModal"),x=te(c),w=te(u),M=te(b),C=te(c),_=te(c),I=te(c),k=te(u),B=te(c),N=te(u),z=te(b),E=te(h),A=te(h),F=te([h]),P=te(S),T=te(c),y((D=t((V=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,i(t,"boosterCostLabel",D,o(t)),i(t,"xMarkNode",H,o(t)),i(t,"imageSprite",R,o(t)),i(t,"titleLabel",j,o(t)),i(t,"levelLabel",K,o(t)),i(t,"incomeLabel",O,o(t)),i(t,"boosterCostNode",q,o(t)),i(t,"nextLevelIncomeLabel",G,o(t)),i(t,"buttonNode",J,o(t)),i(t,"buttonSprite",Q,o(t)),i(t,"payBusterSprite",Y,o(t)),i(t,"noEnoughSprite",W,o(t)),i(t,"boosterSprites",X,o(t)),i(t,"BoosterScrollView",Z,o(t)),i(t,"boosterMessagesLabel",$,o(t)),t.currentItem=null,t.animation=null,t.isAnimating=!1,t}n(t,e);var a=t.prototype;return a.onLoad=function(){this.animation=this.getComponent(p),this.animation||console.warn("Компонент Animation не найден на узле BoosterModal. Пожалуйста, добавьте его в редакторе.");this.getComponent(m)||this.addComponent(m);this.xMarkNode&&((this.xMarkNode.getComponent(d)||this.xMarkNode.addComponent(d)).setContentSize(100,100),(this.xMarkNode.getComponent(g)||this.xMarkNode.addComponent(g)).node.on(g.EventType.CLICK,this.hide,this));this.buttonNode&&(this.buttonNode.getComponent(g)||this.buttonNode.addComponent(g)).node.on(g.EventType.CLICK,this.onBuyUpgrade,this);this.animation&&(this.animation.on(p.EventType.PLAY,this.onAnimationPlay,this),this.animation.on(p.EventType.FINISHED,this.onAnimationFinished,this)),L.instance?L.instance.on("coinsUpdatedExternally",this.updateCoinsLabel,this):console.error("SocketManager.instance не доступен в BoosterModal."),this.node.active=!1},a.onDestroy=function(){L.instance&&L.instance.off("coinsUpdatedExternally",this.updateCoinsLabel,this)},a.onAnimationPlay=function(){this.isAnimating=!0},a.onAnimationFinished=function(){this.isAnimating=!1,this.node.activeInHierarchy||(this.node.active=!1)},a.show=function(e){if(!this.isAnimating)if(this.currentItem=e,L.instance){var t=L.instance.getCurrentCoins(),n=this.boosterSprites.find((function(t){return t.name===e.upgrade_id.toString()}));n&&(this.imageSprite?this.imageSprite.spriteFrame=n:console.error("imageSprite не назначен в BoosterModal.")),this.titleLabel&&(this.titleLabel.string=e.name);var i=null!==e.next_level?e.next_level:e.current_level;this.levelLabel&&(this.levelLabel.string="Уровень "+i),this.incomeLabel&&(null!==e.next_level_cost?this.incomeLabel.string="Увеличить доход \nэтого бустера в час до:":this.incomeLabel.string=""),null!==e.next_level_cost?(this.boosterCostNode.active=!0,this.nextLevelIncomeLabel&&(10===e.current_level?this.nextLevelIncomeLabel.string="Максимальный уровень":this.nextLevelIncomeLabel.string=(e.next_level*e.income_increase_per_level).toString())):this.boosterCostNode.active=!1,null!==e.next_level_cost?(this.buttonNode.active=!0,this.buttonSprite?t>=e.next_level_cost?(this.buttonSprite.spriteFrame=this.payBusterSprite,this.boosterCostLabel.string=e.next_level_cost.toString()):(this.buttonSprite.spriteFrame=this.noEnoughSprite,this.boosterCostLabel.string=e.next_level_cost.toString()):console.error("buttonSprite не назначен в BoosterModal.")):this.buttonNode.active=!1,this.node.active=!0,this.animation&&this.animation.clips.length>0&&this.animation.play("SlideIn")}else console.error("SocketManager.instance не доступен.")},a.hide=function(){var e=this;this.isAnimating||(this.animation&&this.animation.clips.length>0?(this.animation.play("SlideOut"),this.animation.once(p.EventType.FINISHED,(function(){e.node.active=!1}),this)):this.node.active=!1)},a.onBuyUpgrade=function(){var e=r(s().mark((function e(){var t,n,i,o,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentItem){e.next=2;break}return e.abrupt("return");case 2:if(L.instance){e.next=5;break}return console.error("SocketManager.instance не доступен."),e.abrupt("return");case 5:if(!((t=L.instance.getCurrentCoins())>=this.currentItem.next_level_cost)){e.next=41;break}return n=L.instance.getUserId(),i=this.currentItem.upgrade_id,e.prev=9,e.next=12,fetch("https://misapat.ru/api/upgrades/purchase?userId="+n+"&upgradeId="+i,{method:"POST"});case 12:return o=e.sent,e.next=15,o.json();case 15:if(r=e.sent,!o.ok){e.next=31;break}return console.log("Улучшение успешно куплено:",r),a=t-this.currentItem.next_level_cost,L.instance.updateCoins(a),e.next=22,L.instance.fetchPassiveIncomePerHour();case 22:if(this.hide(),!this.BoosterScrollView){e.next=28;break}return e.next=26,this.BoosterScrollView.fetchUpgradeItems();case 26:e.next=29;break;case 28:console.warn("BoosterScrollView не назначен в BoosterModal.");case 29:e.next=33;break;case 31:console.error("Ошибка при покупке улучшения:",r),this.showMessage(r.message||"Ошибка при покупке улучшения.","danger");case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(9),console.error("Ошибка сети при покупке улучшения:",e.t0),this.showMessage("Ошибка сети при покупке улучшения.","danger");case 39:e.next=43;break;case 41:console.log("Недостаточно монет для покупки улучшения"),this.showMessage("Недостаточно монет для покупки улучшения.","warning");case 43:case"end":return e.stop()}}),e,this,[[9,35]])})));return function(){return e.apply(this,arguments)}}(),a.updateCoinsLabel=function(e){this.currentItem&&null!==this.currentItem.next_level_cost&&(e>=this.currentItem.next_level_cost?this.buttonSprite.spriteFrame=this.payBusterSprite:this.buttonSprite.spriteFrame=this.noEnoughSprite)},a.updatePassiveIncomeLabel=function(e){},a.showMessage=function(e,t){if(void 0===t&&(t="info"),this.boosterMessagesLabel)switch(this.boosterMessagesLabel.string=e,t){case"success":this.boosterMessagesLabel.node.color=new f(0,255,0);break;case"danger":this.boosterMessagesLabel.node.color=new f(255,0,0);break;case"warning":this.boosterMessagesLabel.node.color=new f(255,165,0);break;default:this.boosterMessagesLabel.node.color=new f(255,255,255)}else console.warn("boosterMessagesLabel не назначен в BoosterModal.")},t}(v)).prototype,"boosterCostLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(V.prototype,"xMarkNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(V.prototype,"imageSprite",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(V.prototype,"titleLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(V.prototype,"levelLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(V.prototype,"incomeLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(V.prototype,"boosterCostNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(V.prototype,"nextLevelIncomeLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(V.prototype,"buttonNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(V.prototype,"buttonSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(V.prototype,"payBusterSprite",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(V.prototype,"noEnoughSprite",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(V.prototype,"boosterSprites",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Z=t(V.prototype,"BoosterScrollView",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(V.prototype,"boosterMessagesLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=V))||U));a._RF.pop()}}}));

System.register("chunks:///_virtual/BoosterScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts","./BoosterModal.ts"],(function(e){var r,t,n,o,a,i,s,c,l,u,p,d,f,g,b,h,B,m,_,v,w;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.asyncToGenerator,i=e.regeneratorRuntime,s=e.createForOfIteratorHelperLoose},function(e){c=e.cclegacy,l=e._decorator,u=e.Prefab,p=e.Node,d=e.SpriteFrame,f=e.Component,g=e.Layout,b=e.instantiate,h=e.Sprite,B=e.Label,m=e.Button,_=e.resources},function(e){v=e.SocketManager},function(e){w=e.BoosterModal}],execute:function(){var y,C,x,I,k,S,P,L,D,M,N,T,U;c._RF.push({},"9bf4cPDFfRCioh+5OwoOEFs","BoosterScrollView",void 0);var z=l.ccclass,F=l.property;e("BoosterScrollView",(y=z("BoosterScrollView"),C=F(u),x=F(u),I=F(p),k=F([d]),S=F(w),y((D=r((L=function(e){function r(){for(var r,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return r=e.call.apply(e,[this].concat(a))||this,n(r,"boosterBannerPrefab",D,o(r)),n(r,"boosterBannerMaxLevelPrefab",M,o(r)),n(r,"scrollContent",N,o(r)),n(r,"boosterSprites",T,o(r)),r.boosterSpritesDict={},r.userId=null,n(r,"boosterModal",U,o(r)),r}t(r,e);var c=r.prototype;return c.onLoad=function(){this.initializeBoosterSpritesDict(),this.initializeUserId()},c.start=function(){var e=this;this.scheduleOnce((function(){e.fetchUpgradeItems()}),.1),this.logAvailableBoosters()},c.initializeBoosterSpritesDict=function(){var e=this;this.boosterSprites.forEach((function(r){var t=parseInt(r.name);isNaN(t)?console.warn("Имя спрайта '"+r.name+"' не является валидным upgrade_id"):e.boosterSpritesDict[t]=r}))},c.initializeUserId=function(){v.instance&&v.instance.getUserId()?this.userId=v.instance.getUserId():(this.userId=422840434,console.warn("SocketManager недоступен или не инициализирован. Используется моковый userId: "+this.userId))},c.fetchUpgradeItems=function(){var e=a(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.userId){e.next=4;break}return console.error("userId не инициализирован."),e.abrupt("return");case 4:return e.next=6,fetch("https://misapat.ru/api/upgrades?userId="+this.userId);case 6:if((r=e.sent).ok){e.next=9;break}throw new Error("HTTP error! статус: "+r.status);case 9:return e.next=11,r.json();case 11:t=e.sent,this.populateScrollView(t),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Не удалось получить улучшения:",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),c.populateScrollView=function(){var e=a(i().mark((function e(r){var t,n,o,a,c,l,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.scrollContent.removeAllChildren(),n=s(r);case 2:if((o=n()).done){e.next=12;break}return a=o.value,c=null===a.next_level,l=c?this.boosterBannerMaxLevelPrefab:this.boosterBannerPrefab,u=b(l),e.next=9,this.setupBoosterBanner(u,a,c);case 9:this.scrollContent.addChild(u);case 10:e.next=2;break;case 12:null==(t=this.scrollContent.getComponent(g))||t.updateLayout();case 13:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),c.setupBoosterBanner=function(){var e=a(i().mark((function e(r,t,n){var o,a,s,c,l,u,d,f,g,b,_,v,w,y,C,x,I,k,S,P,L=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=r.getChildByName("Image"))?(a=o.getComponent(h),s=this.boosterSpritesDict[t.upgrade_id],a&&s?a.spriteFrame=s:(console.warn("Не удалось установить спрайт бустера из словаря для upgrade_id: "+t.upgrade_id),console.warn("Доступные ключи в boosterSpritesDict: "+Object.keys(this.boosterSpritesDict).join(", ")),(c=this.boosterSpritesDict[0])&&(a.spriteFrame=c))):console.warn("Не найден узел Image в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id),(l=r.getChildByName("Title"))?(u=l.getComponent(B))?u.string=t.name:console.warn("Компонент Label не найден на узле Title в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел Title в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id),(d=r.getChildByName("Level"))?(f=d.getComponent(B))?(g=t.current_level,f.string="Уровень "+g):console.warn("Компонент Label не найден на узле Level в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел Level в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id),n?(S=r.getChildByName("Income"))&&(P=S.getComponent(B))&&(P.string=t.current_level*t.income_increase_per_level+" (max)"):((b=r.getChildByName("coin"))?(_=b.getChildByName("Price"))?(v=_.getComponent(B))?(w=t.next_level_cost.toString(),v.string=w):console.warn("Компонент Label не найден на узле Price в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел Price в узле coin в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел coin в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id),(y=r.getChildByName("Income"))?(C=y.getComponent(B))?(x=(t.next_level*t.income_increase_per_level).toLocaleString("ru-RU"),C.string=x):console.warn("Компонент Label не найден на узле Income в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел Income в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id),(I=r.getChildByName("payButton"))?(k=I.getComponent(m))?(k.node.off(m.EventType.CLICK),k.node.on(m.EventType.CLICK,(function(){L.onBuyUpgrade(t)}),this)):console.warn("Компонент Button не найден на узле payButton в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id):console.warn("Не найден узел payButton в BoosterBanner Prefab для upgrade_id: "+t.upgrade_id)),r.on(p.EventType.TOUCH_END,(function(){L.onBannerClicked(t)}),this);case 8:case"end":return e.stop()}}),e,this)})));return function(r,t,n){return e.apply(this,arguments)}}(),c.onBuyUpgrade=function(){var e=a(i().mark((function e(r){var t,n,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r.next_level_cost){e.next=3;break}return console.log("Бустер достиг максимального уровня, покупка невозможна."),e.abrupt("return");case 3:if(v.instance){e.next=6;break}return console.error("SocketManager.instance не доступен."),e.abrupt("return");case 6:if(!((t=v.instance.getCurrentCoins())>=r.next_level_cost)){e.next=32;break}return e.prev=8,n=v.instance.getUserId(),e.next=12,fetch("https://misapat.ru/api/upgrades/purchase?userId="+n+"&upgradeId="+r.upgrade_id,{method:"POST"});case 12:return o=e.sent,e.next=15,o.json();case 15:if(a=e.sent,!o.ok){e.next=24;break}return console.log("Улучшение успешно куплено:",a),s=t-r.next_level_cost,v.instance.updateCoins(s),e.next=22,this.fetchUpgradeItems();case 22:e.next=25;break;case 24:console.error("Ошибка при покупке улучшения:",a);case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(8),console.error("Ошибка сети при покупке улучшения:",e.t0);case 30:e.next=33;break;case 32:console.log("Недостаточно монет для покупки улучшения");case 33:case"end":return e.stop()}}),e,this,[[8,27]])})));return function(r){return e.apply(this,arguments)}}(),c.onBannerClicked=function(e){this.boosterModal?this.boosterModal.show(e):console.warn("Модальное окно не назначено в BoosterScrollView.")},c.logAvailableBoosters=function(){var e=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.loadDir("images/backgrounds/boosters",d,(function(e,r){e&&console.error("Ошибка загрузки директории бустеров:",e)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r}(f)).prototype,"boosterBannerPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=r(L.prototype,"boosterBannerMaxLevelPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=r(L.prototype,"scrollContent",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=r(L.prototype,"boosterSprites",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=r(L.prototype,"boosterModal",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=L))||P));c._RF.pop()}}}));

System.register("chunks:///_virtual/DailyCardsDetailsModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var a,t,r,o,l,i,n,s,d,c,u,C,h,p,D;return{setters:[function(e){a=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,l=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){n=e.cclegacy,s=e._decorator,d=e.Button,c=e.Label,u=e.Sprite,C=e.SpriteFrame,h=e.resources,p=e.Component},function(e){D=e.SocketManager}],execute:function(){var y,g,m,b,M,f,w,B,v,L,R,k,I,S,z,F,T,O,x;n._RF.push({},"22e80elXJBL5bdvJNtADFiY","DailyCardsDetailsModal",void 0);var _=s.ccclass,E=s.property;e("DailyCardsDetailsModal",(y=_("DailyCardsDetailsModal"),g=E(d),m=E(c),b=E(c),M=E(c),f=E(u),w=E(d),B=E(d),v=E(C),y((k=a((R=function(e){function a(){for(var a,t=arguments.length,l=new Array(t),i=0;i<t;i++)l[i]=arguments[i];return a=e.call.apply(e,[this].concat(l))||this,r(a,"closeButton",k,o(a)),r(a,"dayNumberLabel",I,o(a)),r(a,"nameLabel",S,o(a)),r(a,"messageLabel",z,o(a)),r(a,"cardImageSprite",F,o(a)),r(a,"openCardButton",T,o(a)),r(a,"claimRewardButton",O,o(a)),r(a,"cardBackSpriteFrame",x,o(a)),a.currentCard=null,a.isCardOpened=!1,a}t(a,e);var n=a.prototype;return n.onLoad=function(){this.node.active=!1,this.closeButton?(this.closeButton.node.on(d.EventType.CLICK,this.hideModal,this),console.log("DailyCardsDetailsModal: Назначен обработчик клика на closeButton.")):console.error("DailyCardsDetailsModal: closeButton не назначен в инспекторе."),this.openCardButton?(this.openCardButton.node.on(d.EventType.CLICK,this.onOpenCardClicked,this),console.log("DailyCardsDetailsModal: Назначен обработчик клика на openCardButton.")):console.error("DailyCardsDetailsModal: openCardButton не назначен в инспекторе."),this.claimRewardButton?(this.claimRewardButton.node.on(d.EventType.CLICK,this.onClaimRewardClicked,this),console.log("DailyCardsDetailsModal: Назначен обработчик клика на claimRewardButton.")):console.error("DailyCardsDetailsModal: claimRewardButton не назначен в инспекторе.")},n.showModal=function(e){console.log("DailyCardsDetailsModal: showModal вызван для дня "+e.day),this.currentCard=e,this.isCardOpened=e.opened,this.node.active=!0,e&&(this.dayNumberLabel?(this.dayNumberLabel.string="День "+e.day,console.log("DailyCardsDetailsModal: Установлен номер дня "+e.day+".")):console.warn("DailyCardsDetailsModal: dayNumberLabel не назначен."),this.nameLabel&&this.messageLabel&&this.claimRewardButton&&(this.nameLabel.node.active=!1,this.messageLabel.node.active=!1,this.claimRewardButton.node.active=!1,console.log("DailyCardsDetailsModal: Скрыты nameLabel, messageLabel и claimRewardButton.")),this.cardImageSprite&&this.cardBackSpriteFrame&&(this.cardImageSprite.spriteFrame=this.cardBackSpriteFrame,console.log("DailyCardsDetailsModal: Установлена рубашка карты для дня "+e.day+".")),e.opened&&this.showCardContent())},n.onOpenCardClicked=function(){console.log("DailyCardsDetailsModal: Клик на кнопку 'Открыть карту'."),this.currentCard?this.isCardOpened?console.log("DailyCardsDetailsModal: Карточка уже открыта."):this.openCard():console.error("DailyCardsDetailsModal: Текущая карточка не установлена.")},n.openCard=function(){var e=l(i().mark((function e(){var a,t,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentCard){e.next=3;break}return console.error("DailyCardsDetailsModal: Текущая карточка не установлена."),e.abrupt("return");case 3:if(a=D.instance.getUserId(),t=this.currentCard.day,console.log("DailyCardsDetailsModal: Отправка запроса на открытие карты дня "+t+" для пользователя "+a),a){e.next=10;break}return console.error("DailyCardsDetailsModal: userId не найден в SocketManager."),this.showMessage("Ошибка: Не удалось получить userId.","danger"),e.abrupt("return");case 10:return e.prev=10,e.next=13,fetch("https://misapat.ru/api/daily-cards/open?userId="+a+"&cardId="+t,{method:"POST",headers:{"Content-Type":"application/json"}});case 13:return r=e.sent,e.next=16,r.json();case 16:o=e.sent,r.ok?(console.log("DailyCardsDetailsModal: Карточка дня "+t+" успешно открыта:",o),this.showMessage("Карточка успешно открыта!","success"),this.currentCard.opened=!0,o.card&&(this.currentCard.card=o.card),this.isCardOpened=!0,this.showCardContent()):(console.error("DailyCardsDetailsModal: Ошибка при открытии карточки дня "+t+":",o),this.showMessage("Ошибка: "+(o.message||"Неизвестная ошибка."),"danger")),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(10),console.error("DailyCardsDetailsModal: Ошибка сети при открытии карточки:",e.t0),this.showMessage("Ошибка сети: Не удалось открыть карточку.","danger");case 24:case"end":return e.stop()}}),e,this,[[10,20]])})));return function(){return e.apply(this,arguments)}}(),n.showCardContent=function(){var e,a=this;if(this.currentCard){var t=null==(e=this.currentCard.card)?void 0:e.image_url.replace(".webp","");console.log("DailyCardsDetailsModal: Загрузка изображения карты по пути "+t+"."),t?h.load(t,C,(function(e,r){var o,l,i;if(e)return console.error("DailyCardsDetailsModal: Ошибка при загрузке изображения карты по пути "+t+":",e),void a.showMessage("Ошибка загрузки изображения карты.","danger");(a.cardImageSprite.spriteFrame=r,console.log("DailyCardsDetailsModal: Лицевая сторона карты для дня "+a.currentCard.day+" установлена."),a.nameLabel&&a.messageLabel)&&(a.nameLabel.node.active=!0,a.messageLabel.node.active=!0,a.nameLabel.string=(null==(l=a.currentCard.card)?void 0:l.name)||"Без имени",a.messageLabel.string=(null==(i=a.currentCard.card)?void 0:i.message)||"Нет сообщения",console.log("DailyCardsDetailsModal: Название и сообщение установлены."));a.claimRewardButton&&null!=(o=a.currentCard.card)&&o.reward_amount?(a.claimRewardButton.node.active=!0,console.log("DailyCardsDetailsModal: Кнопка 'Забрать награду' отображена.")):(a.claimRewardButton.node.active=!1,console.log("DailyCardsDetailsModal: Кнопка 'Забрать награду' скрыта."))})):(console.warn("DailyCardsDetailsModal: image_url отсутствует для дня "+this.currentCard.day),this.showMessage("Ошибка: Отсутствует изображение карты.","danger"))}},n.onClaimRewardClicked=function(){console.log("DailyCardsDetailsModal: Клик на кнопку 'Забрать награду'."),this.hideModal()},n.hideModal=function(){console.log("DailyCardsDetailsModal: hideModal вызван"),this.node.active=!1,console.log("DailyCardsDetailsModal: Модальное окно скрыто.")},n.showMessage=function(e,a){void 0===a&&(a="info"),console.log("DailyCardsDetailsModal: "+a.toUpperCase()+": "+e)},n.onDestroy=function(){this.closeButton&&(this.closeButton.node.off(d.EventType.CLICK,this.hideModal,this),console.log("DailyCardsDetailsModal: Обработчик клика с closeButton удалён.")),this.openCardButton&&(this.openCardButton.node.off(d.EventType.CLICK,this.onOpenCardClicked,this),console.log("DailyCardsDetailsModal: Обработчик клика с openCardButton удалён.")),this.claimRewardButton&&(this.claimRewardButton.node.off(d.EventType.CLICK,this.onClaimRewardClicked,this),console.log("DailyCardsDetailsModal: Обработчик клика с claimRewardButton удалён."))},a}(p)).prototype,"closeButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=a(R.prototype,"dayNumberLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=a(R.prototype,"nameLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=a(R.prototype,"messageLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=a(R.prototype,"cardImageSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=a(R.prototype,"openCardButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=a(R.prototype,"claimRewardButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=a(R.prototype,"cardBackSpriteFrame",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=R))||L));n._RF.pop()}}}));

System.register("chunks:///_virtual/DailyCardsModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DailyCardUtils.ts","./UnlockedModalCard.ts","./LockedModalCard.ts","./OpenedModalCard.ts","./DailyCardsDetailsModal.ts"],(function(e){var o,a,l,n,t,i,r,d,s,c,u,C,p,f,y,M;return{setters:[function(e){o=e.applyDecoratedDescriptor,a=e.inheritsLoose,l=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){t=e.cclegacy,i=e._decorator,r=e.ScrollView,d=e.Prefab,s=e.Button,c=e.instantiate,u=e.Component},function(e){C=e.isCardAvailable},function(e){p=e.UnlockedModalCard},function(e){f=e.LockedModalCard},function(e){y=e.OpenedModalCard},function(e){M=e.DailyCardsDetailsModal}],execute:function(){var h,D,b,v,w,m,g,B,P,k,z,L,S,I,V;t._RF.push({},"7c18dlYu5RF5LQCQdfUNYsp","DailyCardsModal",void 0);var T=i.ccclass,x=i.property;e("DailyCardsModal",(h=T("DailyCardsModal"),D=x(r),b=x(d),v=x(d),w=x(d),m=x(s),g=x(M),h((k=o((P=function(e){function o(){for(var o,a=arguments.length,t=new Array(a),i=0;i<a;i++)t[i]=arguments[i];return o=e.call.apply(e,[this].concat(t))||this,l(o,"modalScrollView",k,n(o)),l(o,"unlockedModalCardPrefab",z,n(o)),l(o,"lockedModalCardPrefab",L,n(o)),l(o,"openedModalCardPrefab",S,n(o)),l(o,"closeButton",I,n(o)),l(o,"dailyCardsDetailsModal",V,n(o)),o}a(o,e);var t=o.prototype;return t.onLoad=function(){this.node.active=!1,this.node.zIndex=1e3,this.closeButton?this.closeButton.node.on(s.EventType.CLICK,this.hideModal,this):console.warn("DailyCardsModal: closeButton не установлен в инспекторе")},t.showModal=function(e){var o=this;if(this.node.active=!0,this.node.zIndex=1e3,this.node.parent?this.node.setSiblingIndex(this.node.parent.children.length-1):console.warn("DailyCardsModal: Узел не имеет родителя"),this.modalScrollView&&this.modalScrollView.content){var a=this.modalScrollView.content;a.removeAllChildren();var l=e.sort((function(e,o){return e.day-o.day})),n=l.find((function(e){return e.opened}))||null;l.forEach((function(e){var l=null;if(l=e.opened?o.openedModalCardPrefab:C(e,n)?o.unlockedModalCardPrefab:o.lockedModalCardPrefab){var t,i=c(l);if(i.parent=a,(t=e.opened?i.getComponent(y):C(e,n)?i.getComponent(p):i.getComponent(f))?t.setCardData(e):console.warn("DailyCardsModal: Компонент карточки не найден на префабе для дня",e.day),e.opened||C(e,n)){var r,d=null==(r=i.getChildByName("OpenCardButton"))?void 0:r.getComponent(s);d&&o.dailyCardsDetailsModal?d.node.on(s.EventType.CLICK,(function(){o.openDetailsModal(e)}),o):(d||console.warn("DailyCardsModal: OpenCardButton не найден на префабе для дня "+e.day),o.dailyCardsDetailsModal||console.warn("DailyCardsModal: dailyCardsDetailsModal не назначен в инспекторе"))}}else console.error("DailyCardsModal: Префаб не найден для дня",e.day)})),this.modalScrollView.scrollToTop(0,!1)}},t.openDetailsModal=function(e){this.dailyCardsDetailsModal?(console.log("Открываем детали для карты дня "+e.day),this.dailyCardsDetailsModal.showModal(e)):console.error("DailyCardsDetailsModal не назначен в DailyCardsModal.")},t.hideModal=function(){this.node.active=!1},t.onDestroy=function(){this.closeButton&&this.closeButton.node.off(s.EventType.CLICK,this.hideModal,this)},o}(u)).prototype,"modalScrollView",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=o(P.prototype,"unlockedModalCardPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=o(P.prototype,"lockedModalCardPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=o(P.prototype,"openedModalCardPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=o(P.prototype,"closeButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=o(P.prototype,"dailyCardsDetailsModal",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=P))||B));t._RF.pop()}}}));

System.register("chunks:///_virtual/DailyCardsPage.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts","./DayCard.ts","./DailyCardsModal.ts","./DailyCardUtils.ts"],(function(r){var e,a,t,n,i,o,l,s,c,d,u,y,f,p,C,b,h;return{setters:[function(r){e=r.applyDecoratedDescriptor,a=r.inheritsLoose,t=r.initializerDefineProperty,n=r.assertThisInitialized,i=r.asyncToGenerator,o=r.regeneratorRuntime},function(r){l=r.cclegacy,s=r._decorator,c=r.ScrollView,d=r.Prefab,u=r.instantiate,y=r.Node,f=r.Component},function(r){p=r.SocketManager},function(r){C=r.DayCard},function(r){b=r.DailyCardsModal},function(r){h=r.isCardAvailable}],execute:function(){var v,g,k,w,D,P,m,S,x,M,E,U,I,z,L,V,N;l._RF.push({},"a3499p6cPRCUJJIwp3y1e/G","DailyCardsPage",void 0);var T=s.ccclass,A=s.property;r("DailyCardsPage",(v=T("DailyCardsPage"),g=A(c),k=A(d),w=A(d),D=A(d),P=A(String),m=A(String),S=A(b),v((E=e((M=function(r){function e(){for(var e,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return e=r.call.apply(r,[this].concat(i))||this,t(e,"dailyCardsScrollView",E,n(e)),t(e,"openedEverydayCardPrefab",U,n(e)),t(e,"unlockedEverydayCardPrefab",I,n(e)),t(e,"lockedEverydayCardPrefab",z,n(e)),t(e,"dailyCardsApiUrl",L,n(e)),t(e,"dayNumberPrefix",V,n(e)),t(e,"dailyCardsModal",N,n(e)),e.dailyCardsList=[],e}a(e,r);var l=e.prototype;return l.start=function(){p.instance?p.instance.getUserId()?this.fetchDailyCards():console.error("userId не установлен в SocketManager."):console.error("SocketManager не инициализирован.")},l.fetchDailyCards=function(){var r=i(o().mark((function r(){var e,a,t;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e=p.instance.getUserId()){r.next=4;break}return console.error("userId не установлен в SocketManager."),r.abrupt("return");case 4:return r.prev=4,r.next=7,fetch(this.dailyCardsApiUrl+"?userId="+e);case 7:if((a=r.sent).ok){r.next=13;break}if(404!==a.status){r.next=12;break}return console.warn("Карточки дня пока недоступны."),r.abrupt("return");case 12:throw new Error("Network response was not ok");case 13:return r.next=15,a.json();case 15:(t=r.sent)&&t.cards&&(this.dailyCardsList=t.cards,this.populateDailyCardsList(t.cards)),this.dailyCardsScrollView&&this.dailyCardsScrollView.scrollToLeft(0,!1),r.next=23;break;case 20:r.prev=20,r.t0=r.catch(4),console.error("Ошибка при загрузке карточек дня:",r.t0);case 23:case"end":return r.stop()}}),r,this,[[4,20]])})));return function(){return r.apply(this,arguments)}}(),l.populateDailyCardsList=function(r){var e=this;if(this.dailyCardsScrollView){var a=this.dailyCardsScrollView.content;if(a){a.removeAllChildren();var t=r.sort((function(r,e){return r.day-e.day})),n=t.filter((function(r){return r.opened})),i=n.length>0?n[n.length-1]:null;t.forEach((function(r){var t=null;if(t=r.opened?e.openedEverydayCardPrefab:h(r,i)?e.unlockedEverydayCardPrefab:e.lockedEverydayCardPrefab){var n=u(t);n.parent=a,n.active=!0;var o=n.getComponent(C);o?(o.setDayNumber(r.day,e.dayNumberPrefix),o.setCardData(r)):console.warn("Компонент DayCard не найден на инстанцированном префабе."),n.on(y.EventType.TOUCH_END,(function(){e.onDayCardClick(r)})),n.on("unlockCard",(function(r){e.handleUnlockCard(r)}))}else console.error("Префаб для инстанцирования не назначен.")}))}else console.error("dailyCardsScrollView.content не назначен.")}else console.error("dailyCardsScrollView не назначен.")},l.onDayCardClick=function(r){var e=this.dailyCardsList.filter((function(r){return r.opened})).sort((function(r,e){return e.day-r.day}))[0]||null;h(r,e)||r.opened?this.dailyCardsModal?this.dailyCardsModal.showModal(this.dailyCardsList):console.error("DailyCardsModal не назначен в DailyCardsPage."):console.warn("Карточка не доступна для открытия.")},l.handleUnlockCard=function(){var r=i(o().mark((function r(e){var a,t,n;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,a=p.instance.getUserId()){r.next=5;break}return console.error("userId не установлен в SocketManager."),r.abrupt("return");case 5:return r.next=7,fetch("https://misapat.ru/api/daily-cards/unlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,day:e.day})});case 7:return t=r.sent,r.next=10,t.json();case 10:n=r.sent,t.ok?this.fetchDailyCards():console.error("Ошибка при разблокировке карточки дня "+e.day+":",n),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(0),console.error("Ошибка сети при разблокировке карточки дня "+e.day+":",r.t0);case 17:case"end":return r.stop()}}),r,this,[[0,14]])})));return function(e){return r.apply(this,arguments)}}(),e}(f)).prototype,"dailyCardsScrollView",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(M.prototype,"openedEverydayCardPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(M.prototype,"unlockedEverydayCardPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(M.prototype,"lockedEverydayCardPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(M.prototype,"dailyCardsApiUrl",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/daily-cards"}}),V=e(M.prototype,"dayNumberPrefix",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),N=e(M.prototype,"dailyCardsModal",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=M))||x));l._RF.pop()}}}));

System.register("chunks:///_virtual/DailyCardUtils.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){e("isCardAvailable",(function(e,t){if(!t)return 1===e.day;if(e.day===t.day+1){if(t.timestamp){var i=new Date(t.timestamp).getTime();return((new Date).getTime()-i)/36e5>=24}return!1}return!1})),t._RF.push({},"85959WXen9N5K5NpUHkf7hK","DailyCardUtils",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/DayCard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,a,r,n,i,o,l,c,u,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){i=t.cclegacy,o=t._decorator,l=t.Label,c=t.Sprite,u=t.Button,s=t.Component}],execute:function(){var d,h,p,b,y,f,g,k,m,L,w;i._RF.push({},"527acgmahlEspt4o+8udeNL","DayCard",void 0);var C=o.ccclass,D=o.property;t("DayCard",(d=C("DayCard"),h=D(l),p=D(l),b=D(c),y=D(u),d((k=e((g=function(t){function e(){for(var e,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"dayLabel",k,n(e)),r(e,"rewardLabel",m,n(e)),r(e,"cardImage",L,n(e)),r(e,"unlockButton",w,n(e)),e.cardData=null,e}a(e,t);var i=e.prototype;return i.setDayNumber=function(t,e){void 0===e&&(e=""),this.dayLabel?this.dayLabel.string=""+e+t:console.warn("dayLabel не назначен на компоненте DayCard.")},i.setCardData=function(t){this.cardData=t,t.opened&&t.card?(this.rewardLabel&&(this.rewardLabel.string="Награда: "+t.card.reward_amount),this.cardImage&&t.card.image_url&&(this.cardImage.spriteFrame=this.cardImage.spriteFrame),this.unlockButton&&(this.unlockButton.node.active=!1)):!t.opened&&this.isCardAvailable(t)?(this.rewardLabel&&(this.rewardLabel.string="Награда: "+(t.card?t.card.reward_amount:"?")),this.unlockButton&&(this.unlockButton.node.active=!0,this.unlockButton.node.on(u.EventType.CLICK,this.onUnlockClick,this))):(this.rewardLabel&&(this.rewardLabel.string=""),this.unlockButton&&(this.unlockButton.node.active=!1))},i.onUnlockClick=function(){this.cardData&&this.node.emit("unlockCard",this.cardData)},i.isCardAvailable=function(t){var e=(new Date).getDate();return t.day<=e&&!t.opened},i.onDestroy=function(){this.unlockButton&&this.unlockButton.node.off(u.EventType.CLICK,this.onUnlockClick,this)},e}(s)).prototype,"dayLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(g.prototype,"rewardLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(g.prototype,"cardImage",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(g.prototype,"unlockButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));i._RF.pop()}}}));

System.register("chunks:///_virtual/FloatingText.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var o,e,r,n,i,a,c,l,s,u,p;return{setters:[function(t){o=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){i=t.cclegacy,a=t._decorator,c=t.Label,l=t.Color,s=t.tween,u=t.Vec3,p=t.Component}],execute:function(){var d,f,h,g;i._RF.push({},"bd2afV6GjdEioGJ6Sb+apw4","FloatingText",void 0);var b=a.ccclass,y=a.property;t("FloatingText",b("FloatingText")((h=o((f=function(t){function o(){for(var o,e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return o=t.call.apply(t,[this].concat(i))||this,r(o,"duration",h,n(o)),r(o,"moveUpDistance",g,n(o)),o}return e(o,t),o.prototype.start=function(){var t=this,o=this.getComponent(c)||this.getComponentInChildren(c);o&&(o.color=new l(o.color.r,o.color.g,o.color.b,255),s(o).to(this.duration,{color:new l(o.color.r,o.color.g,o.color.b,0)}).start(),s(this.node).by(this.duration,{position:new u(0,this.moveUpDistance,0)}).call((function(){t.node.destroy()})).start())},o}(p)).prototype,"duration",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),g=o(f.prototype,"moveUpDistance",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),d=f))||d);i._RF.pop()}}}));

System.register("chunks:///_virtual/FriendsPage.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var t,n,r,i,a,s,o,l,c,u,f,p,d,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){o=e.cclegacy,l=e._decorator,c=e.ScrollView,u=e.Prefab,f=e.Label,p=e.instantiate,d=e.Component},function(e){h=e.SocketManager}],execute:function(){var b,g,m,F,L,v,w,k,y,I;o._RF.push({},"829ce7RYglPV6kmQF/Wbmbm","FriendsPage",void 0);var z=l.ccclass,P=l.property;e("FriendsPage",(b=z("FriendsPage"),g=P(c),m=P(u),F=P(f),b((w=t((v=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,r(t,"scrollView",w,i(t)),r(t,"friendItemPrefab",k,i(t)),r(t,"totalFriendsLabel",y,i(t)),r(t,"apiBaseUrl",I,i(t)),t}n(t,e);var o=t.prototype;return o.onEnable=function(){if(!h.instance)return console.error("SocketManager не инициализирован."),void(this.totalFriendsLabel.string="Ошибка инициализации.");h.instance.getUserId()?this.fetchFriends():h.instance.on("userInitialized",this.onUserInitialized,this)},o.onDisable=function(){h.instance&&h.instance.off("userInitialized",this.onUserInitialized,this)},o.start=function(){},o.onUserInitialized=function(){this.fetchFriends()},o.fetchFriends=function(){var e=a(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.instance.getUserId()){e.next=5;break}return console.error("userId не установлен в SocketManager."),this.totalFriendsLabel.string="Неизвестный пользователь.",e.abrupt("return");case 5:return e.prev=5,e.next=8,fetch(this.apiBaseUrl+"/"+t);case 8:if((n=e.sent).ok){e.next=15;break}if(404!==n.status){e.next=14;break}return this.totalFriendsLabel.string="У тебя пока нет друзей",this.populateFriendsList([]),e.abrupt("return");case 14:throw new Error("Network response was not ok");case 15:return e.next=17,n.json();case 17:r=e.sent,this.totalFriendsLabel.string="У тебя "+r.length+" друзей",this.populateFriendsList(r),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(5),console.error("Ошибка при загрузке списка друзей:",e.t0),this.totalFriendsLabel.string="Не удалось загрузить список друзей.",this.populateFriendsList([]);case 27:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(){return e.apply(this,arguments)}}(),o.populateFriendsList=function(e){var t=this,n=this.scrollView.content;n.removeAllChildren(),e.forEach((function(e,r){var i=p(t.friendItemPrefab);i.parent=n;var a=i.getComponentsInChildren(f),s=null,o=null,l=null;a.forEach((function(e){var t=e.node.name;"UsernameLabel"===t?s=e:"NumberLabel"===t?o=e:"CoinsLabel"===t&&(l=e)})),s&&o&&l?(s.string=e.username,o.string=r+1+".",l.string=t.formatCoins(e.coins)):console.warn("Не удалось найти один из Label компонентов в FriendItem")}))},o.formatCoins=function(e){return e>=1e6?Math.round(e/1e6)+"M":Math.round(e).toLocaleString("ru-RU")},t}(d)).prototype,"scrollView",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(v.prototype,"friendItemPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(v.prototype,"totalFriendsLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(v.prototype,"apiBaseUrl",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/referrals"}}),L=v))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameRulesModal.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,l,o,r,i,n,s,a,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,l=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,n=e._decorator,s=e.Node,a=e.Label,u=e.ScrollView,c=e.Component}],execute:function(){var d,h,p,f,M,b,m,w,y,g,v,L,T;i._RF.push({},"13fd9XksVVAHZfrZJ9Lv7Vg","GameRulesModal",void 0);var R=n.ccclass,V=n.property;e("GameRulesModal",(d=R("GameRulesModal"),h=V(s),p=V(s),f=V(a),M=V(u),b=V(s),d((y=t((w=function(e){function t(){for(var t,l=arguments.length,i=new Array(l),n=0;n<l;n++)i[n]=arguments[n];return t=e.call.apply(e,[this].concat(i))||this,o(t,"rulesModal",y,r(t)),o(t,"closeButton",g,r(t)),o(t,"rulesTextLabel",v,r(t)),o(t,"scrollView",L,r(t)),o(t,"contentNode",T,r(t)),t}l(t,e);var i=t.prototype;return i.onLoad=function(){this.rulesModal?this.rulesModal.active=!1:console.error("rulesModal не назначен в GameRulesModal."),this.closeButton?this.closeButton.on(s.EventType.TOUCH_END,this.hideModal,this):console.warn("closeButton не назначен в GameRulesModal."),this.rulesTextLabel&&this.rulesTextLabel.string.length>0&&this.setupScrollView()},i.showModal=function(){this.rulesModal?this.rulesModal.active=!0:console.error("rulesModal не назначен в GameRulesModal.")},i.hideModal=function(){this.rulesModal?this.rulesModal.active=!1:console.error("rulesModal не назначен в GameRulesModal.")},i.setupScrollView=function(){this.scrollView&&this.contentNode?(this.scrollView.content.height=this.rulesTextLabel.node.height,this.rulesTextLabel.fontSize=24,this.rulesTextLabel.lineHeight=30):console.error("scrollView или contentNode не назначены в GameRulesModal.")},i.onDestroy=function(){this.closeButton&&this.closeButton.off(s.EventType.TOUCH_END,this.hideModal,this)},t}(c)).prototype,"rulesModal",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(w.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(w.prototype,"rulesTextLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(w.prototype,"scrollView",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(w.prototype,"contentNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=w))||m));i._RF.pop()}}}));

System.register("chunks:///_virtual/IncomeManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var t,n,r,a,o,c,i,s,u,l,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,c=e.regeneratorRuntime},function(e){i=e.cclegacy,s=e._decorator,u=e.Label,l=e.Component},function(e){p=e.SocketManager}],execute:function(){var m,f,h,I,b;i._RF.push({},"a3599luME5HILUcjWVa3vL6","IncomeManager",void 0);var d=s.ccclass,g=s.property;e("IncomeManager",(m=d("IncomeManager"),f=g(u),m((b=t((I=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return t=e.call.apply(e,[this].concat(o))||this,r(t,"incomeLabel",b,a(t)),t.apiUrl="https://misapat.ru/api/upgrades",t}n(t,e);var i=t.prototype;return i.start=function(){if(this.incomeLabel)return p.instance?void this.fetchIncomeData():(console.error("SocketManager не инициализирован."),void this.updateIncomeLabel("+ 0 доход в час"));console.error("incomeLabel не назначен в IncomeManager.")},i.fetchIncomeData=function(){var e=o(c().mark((function e(){var t,n,r,a,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.instance.getUserId()){e.next=5;break}return console.error("userId не установлен в SocketManager."),this.updateIncomeLabel("+ 0 доход в час"),e.abrupt("return");case 5:return e.prev=5,e.next=8,fetch(this.apiUrl+"?userId="+t);case 8:if((n=e.sent).ok){e.next=11;break}throw new Error("HTTP error! status: "+n.status);case 11:return e.next=13,n.json();case 13:r=e.sent,a=this.calculateTotalIncome(r),o=this.formatIncome(a),this.updateIncomeLabel(o),console.log("Общий доход: "+o),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),console.error("Ошибка при получении данных с API:",e.t0),this.updateIncomeLabel("+ 0 доход в час");case 24:case"end":return e.stop()}}),e,this,[[5,20]])})));return function(){return e.apply(this,arguments)}}(),i.calculateTotalIncome=function(e){return e.reduce((function(e,t){return e+(t.cumulative_income||0)}),0)},i.formatIncome=function(e){return e>=1e3?"+ "+(e/1e3).toFixed(0)+"K доход в час":"+ "+e+" доход в час"},i.updateIncomeLabel=function(e){this.incomeLabel.string=e},t}(l)).prototype,"incomeLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=I))||h));i._RF.pop()}}}));

System.register("chunks:///_virtual/index.mjs_cjs=&original=2.js",["./index2.js","./cjs-loader.mjs"],(function(e,t){var r,n;return{setters:[function(t){r=t.__cjsMetaURL;var n={};n.__cjsMetaURL=t.__cjsMetaURL,n.default=t.default,e(n)},function(e){n=e.default}],execute:function(){r||n.throwInvalidWrapper("./index.js",t.meta.url),n.require(r)}}}));

System.register("chunks:///_virtual/index.mjs_cjs=&original=3.js",["./index3.js","./cjs-loader.mjs"],(function(e,t){var r,n;return{setters:[function(t){r=t.__cjsMetaURL;var n={};n.__cjsMetaURL=t.__cjsMetaURL,n.default=t.default,e(n)},function(e){n=e.default}],execute:function(){r||n.throwInvalidWrapper("./index.js",t.meta.url),n.require(r)}}}));

System.register("chunks:///_virtual/index2.js",["./cjs-loader.mjs"],(function(e,a){var t;return{setters:[function(e){t=e.default}],execute:function(){e("default",void 0);var i=e("__cjsMetaURL",a.meta.url);t.define(i,(function(a,t,i,o,s){var r,n;System.register("chunks:///_virtual/builtin-pipeline-settings.ts",["./rollupPluginModLoBabelHelpers.js","cc","./builtin-pipeline-types.ts"],(function(e){var a,t,i,o,s,r,n,l,d,c,h,p,g,u,f,m,_;return{setters:[function(e){a=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.createClass,o=e.initializerDefineProperty,s=e.assertThisInitialized},function(e){r=e.cclegacy,n=e._decorator,l=e.Camera,d=e.CCBoolean,c=e.CCInteger,h=e.CCFloat,p=e.Material,g=e.Texture2D,u=e.rendering,f=e.Component},function(e){m=e.fillRequiredPipelineSettings,_=e.makePipelineSettings}],execute:function(){var b,S,P,R,M,y,w,T,C,E,v,x,D,A,F,O,L,k,B,G,N,z,Q,I,H,U,V,W,j,X,q,Y,K,Z;r._RF.push({},"de1c2EHcMhAIYRZY5nyTQHG","builtin-pipeline-settings",void 0);var J=n.ccclass,$=n.disallowMultiple,ee=n.executeInEditMode,ae=n.menu,te=n.property,ie=n.requireComponent,oe=n.type;e("BuiltinPipelineSettings",(b=J("BuiltinPipelineSettings"),S=ae("Rendering/BuiltinPipelineSettings"),P=ie(l),R=te(d),M=te({displayName:"Editor Preview (Experimental)",type:d}),y=te({group:{id:"MSAA",name:"Multisample Anti-Aliasing"},type:d}),w=te({group:{id:"MSAA",name:"Multisample Anti-Aliasing",style:"section"},type:c,range:[2,4,2]}),T=te({group:{id:"ShadingScale",name:"ShadingScale",style:"section"},type:d}),C=te({tooltip:"i18n:postprocess.shadingScale",group:{id:"ShadingScale",name:"ShadingScale"},type:h,range:[.01,4,.01],slide:!0}),E=te({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:d,visible:!1}),v=te({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:p,visible:!1}),x=te({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:h,min:0,visible:!1}),D=te({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:h,min:0,visible:!1}),A=oe(h),F=te({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:h,range:[1,10,.01],slide:!0,visible:!1}),O=te({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:d}),L=te({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:p}),k=te({tooltip:"i18n:bloom.enableAlphaMask",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:d}),B=te({tooltip:"i18n:bloom.iterations",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:c,range:[1,6,1],slide:!0}),G=te({tooltip:"i18n:bloom.threshold",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:h,min:0}),N=te({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:d}),z=te({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:p}),Q=te({tooltip:"i18n:color_grading.contribute",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:h,range:[0,1,.01],slide:!0}),I=te({tooltip:"i18n:color_grading.originalMap",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:g}),H=te({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:d}),U=te({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:p}),V=te({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:d}),W=te({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:p}),j=te({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:h,range:[0,1,.01],slide:!0}),X=te({group:{id:"ToneMapping",name:"ToneMapping",style:"section"},type:p}),b(q=S(q=P(q=$(q=ee((K=a((Y=function(e){function a(){for(var a,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return a=e.call.apply(e,[this].concat(i))||this,o(a,"_settings",K,s(a)),o(a,"_editorPreview",Z,s(a)),a}t(a,e);var r=a.prototype;return r.onEnable=function(){m(this._settings),this.getComponent(l).camera.pipelineSettings=this._settings},r.onDisable=function(){this.getComponent(l).camera.pipelineSettings=null},r._tryEnableEditorPreview=function(){void 0!==u&&(this._editorPreview?u.setEditorPipelineSettings(this._settings):this._disableEditorPreview())},r._disableEditorPreview=function(){void 0!==u&&u.getEditorPipelineSettings()===this._settings&&u.setEditorPipelineSettings(null)},i(a,[{key:"editorPreview",get:function(){return this._editorPreview},set:function(e){this._editorPreview=e}},{key:"MsaaEnable",get:function(){return this._settings.msaa.enabled},set:function(e){this._settings.msaa.enabled=e}},{key:"msaaSampleCount",get:function(){return this._settings.msaa.sampleCount},set:function(e){e=Math.pow(2,Math.ceil(Math.log2(Math.max(e,2)))),e=Math.min(e,4),this._settings.msaa.sampleCount=e}},{key:"shadingScaleEnable",get:function(){return this._settings.enableShadingScale},set:function(e){this._settings.enableShadingScale=e}},{key:"shadingScale",get:function(){return this._settings.shadingScale},set:function(e){this._settings.shadingScale=e}},{key:"dofEnable",get:function(){return this._settings.depthOfField.enabled},set:function(e){this._settings.depthOfField.enabled=e}},{key:"dofMaterial",get:function(){return this._settings.depthOfField.material},set:function(e){this._settings.depthOfField.material!==e&&(this._settings.depthOfField.material=e)}},{key:"dofFocusDistance",get:function(){return this._settings.depthOfField.focusDistance},set:function(e){this._settings.depthOfField.focusDistance=e}},{key:"dofFocusRange",get:function(){return this._settings.depthOfField.focusRange},set:function(e){this._settings.depthOfField.focusRange=e}},{key:"dofBokehRadius",get:function(){return this._settings.depthOfField.bokehRadius},set:function(e){this._settings.depthOfField.bokehRadius=e}},{key:"bloomEnable",get:function(){return this._settings.bloom.enabled},set:function(e){this._settings.bloom.enabled=e}},{key:"bloomMaterial",get:function(){return this._settings.bloom.material},set:function(e){this._settings.bloom.material!==e&&(this._settings.bloom.material=e)}},{key:"bloomEnableAlphaMask",get:function(){return this._settings.bloom.enableAlphaMask},set:function(e){this._settings.bloom.enableAlphaMask=e}},{key:"bloomIterations",get:function(){return this._settings.bloom.iterations},set:function(e){this._settings.bloom.iterations=e}},{key:"bloomThreshold",get:function(){return this._settings.bloom.threshold},set:function(e){this._settings.bloom.threshold=e}},{key:"bloomIntensity",get:function(){return this._settings.bloom.intensity},set:function(e){this._settings.bloom.intensity=e}},{key:"colorGradingEnable",get:function(){return this._settings.colorGrading.enabled},set:function(e){this._settings.colorGrading.enabled=e}},{key:"colorGradingMaterial",get:function(){return this._settings.colorGrading.material},set:function(e){this._settings.colorGrading.material!==e&&(this._settings.colorGrading.material=e)}},{key:"colorGradingContribute",get:function(){return this._settings.colorGrading.contribute},set:function(e){this._settings.colorGrading.contribute=e}},{key:"colorGradingMap",get:function(){return this._settings.colorGrading.colorGradingMap},set:function(e){this._settings.colorGrading.colorGradingMap=e}},{key:"fxaaEnable",get:function(){return this._settings.fxaa.enabled},set:function(e){this._settings.fxaa.enabled=e}},{key:"fxaaMaterial",get:function(){return this._settings.fxaa.material},set:function(e){this._settings.fxaa.material!==e&&(this._settings.fxaa.material=e)}},{key:"fsrEnable",get:function(){return this._settings.fsr.enabled},set:function(e){this._settings.fsr.enabled=e}},{key:"fsrMaterial",get:function(){return this._settings.fsr.material},set:function(e){this._settings.fsr.material!==e&&(this._settings.fsr.material=e)}},{key:"fsrSharpness",get:function(){return this._settings.fsr.sharpness},set:function(e){this._settings.fsr.sharpness=e}},{key:"toneMappingMaterial",get:function(){return this._settings.toneMapping.material},set:function(e){this._settings.toneMapping.material!==e&&(this._settings.toneMapping.material=e)}}]),a}(f)).prototype,"_settings",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _()}}),Z=a(Y.prototype,"_editorPreview",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a(Y.prototype,"editorPreview",[M],Object.getOwnPropertyDescriptor(Y.prototype,"editorPreview"),Y.prototype),a(Y.prototype,"MsaaEnable",[y],Object.getOwnPropertyDescriptor(Y.prototype,"MsaaEnable"),Y.prototype),a(Y.prototype,"msaaSampleCount",[w],Object.getOwnPropertyDescriptor(Y.prototype,"msaaSampleCount"),Y.prototype),a(Y.prototype,"shadingScaleEnable",[T],Object.getOwnPropertyDescriptor(Y.prototype,"shadingScaleEnable"),Y.prototype),a(Y.prototype,"shadingScale",[C],Object.getOwnPropertyDescriptor(Y.prototype,"shadingScale"),Y.prototype),a(Y.prototype,"dofEnable",[E],Object.getOwnPropertyDescriptor(Y.prototype,"dofEnable"),Y.prototype),a(Y.prototype,"dofMaterial",[v],Object.getOwnPropertyDescriptor(Y.prototype,"dofMaterial"),Y.prototype),a(Y.prototype,"dofFocusDistance",[x],Object.getOwnPropertyDescriptor(Y.prototype,"dofFocusDistance"),Y.prototype),a(Y.prototype,"dofFocusRange",[D],Object.getOwnPropertyDescriptor(Y.prototype,"dofFocusRange"),Y.prototype),a(Y.prototype,"dofBokehRadius",[A,F],Object.getOwnPropertyDescriptor(Y.prototype,"dofBokehRadius"),Y.prototype),a(Y.prototype,"bloomEnable",[O],Object.getOwnPropertyDescriptor(Y.prototype,"bloomEnable"),Y.prototype),a(Y.prototype,"bloomMaterial",[L],Object.getOwnPropertyDescriptor(Y.prototype,"bloomMaterial"),Y.prototype),a(Y.prototype,"bloomEnableAlphaMask",[k],Object.getOwnPropertyDescriptor(Y.prototype,"bloomEnableAlphaMask"),Y.prototype),a(Y.prototype,"bloomIterations",[B],Object.getOwnPropertyDescriptor(Y.prototype,"bloomIterations"),Y.prototype),a(Y.prototype,"bloomThreshold",[G],Object.getOwnPropertyDescriptor(Y.prototype,"bloomThreshold"),Y.prototype),a(Y.prototype,"colorGradingEnable",[N],Object.getOwnPropertyDescriptor(Y.prototype,"colorGradingEnable"),Y.prototype),a(Y.prototype,"colorGradingMaterial",[z],Object.getOwnPropertyDescriptor(Y.prototype,"colorGradingMaterial"),Y.prototype),a(Y.prototype,"colorGradingContribute",[Q],Object.getOwnPropertyDescriptor(Y.prototype,"colorGradingContribute"),Y.prototype),a(Y.prototype,"colorGradingMap",[I],Object.getOwnPropertyDescriptor(Y.prototype,"colorGradingMap"),Y.prototype),a(Y.prototype,"fxaaEnable",[H],Object.getOwnPropertyDescriptor(Y.prototype,"fxaaEnable"),Y.prototype),a(Y.prototype,"fxaaMaterial",[U],Object.getOwnPropertyDescriptor(Y.prototype,"fxaaMaterial"),Y.prototype),a(Y.prototype,"fsrEnable",[V],Object.getOwnPropertyDescriptor(Y.prototype,"fsrEnable"),Y.prototype),a(Y.prototype,"fsrMaterial",[W],Object.getOwnPropertyDescriptor(Y.prototype,"fsrMaterial"),Y.prototype),a(Y.prototype,"fsrSharpness",[j],Object.getOwnPropertyDescriptor(Y.prototype,"fsrSharpness"),Y.prototype),a(Y.prototype,"toneMappingMaterial",[X],Object.getOwnPropertyDescriptor(Y.prototype,"toneMappingMaterial"),Y.prototype),q=Y))||q)||q)||q)||q)||q)),r._RF.pop()}}})),System.register("chunks:///_virtual/builtin-pipeline-types.ts",["cc"],(function(e){var a,t;return{setters:[function(e){a=e.cclegacy,t=e.gfx}],execute:function(){e({fillRequiredBloom:n,fillRequiredColorGrading:l,fillRequiredDepthOfField:r,fillRequiredFSR:d,fillRequiredFXAA:c,fillRequiredHBAO:function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.radiusScale&&(e.radiusScale=1),void 0===e.angleBiasDegree&&(e.angleBiasDegree=10),void 0===e.blurSharpness&&(e.blurSharpness=3),void 0===e.aoSaturation&&(e.aoSaturation=1),void 0===e.needBlur&&(e.needBlur=!1)},fillRequiredMSAA:s,fillRequiredPipelineSettings:function(e){e.msaa?s(e.msaa):e.msaa=o(),void 0===e.enableShadingScale&&(e.enableShadingScale=!1),void 0===e.shadingScale&&(e.shadingScale=.5),e.depthOfField?r(e.depthOfField):e.depthOfField={enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1},e.bloom?n(e.bloom):e.bloom={enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},e.toneMapping?h(e.toneMapping):e.toneMapping={material:null},e.colorGrading?l(e.colorGrading):e.colorGrading={enabled:!1,material:null,contribute:1,colorGradingMap:null},e.fsr?d(e.fsr):e.fsr={enabled:!1,material:null,sharpness:.8},e.fxaa?c(e.fxaa):e.fxaa={enabled:!1,material:null}},fillRequiredToneMapping:h,makeBloom:function(){return{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3}},makeColorGrading:function(){return{enabled:!1,material:null,contribute:1,colorGradingMap:null}},makeDepthOfField:function(){return{enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1}},makeFSR:function(){return{enabled:!1,material:null,sharpness:.8}},makeFXAA:function(){return{enabled:!1,material:null}},makeHBAO:function(){return{enabled:!1,radiusScale:1,angleBiasDegree:10,blurSharpness:3,aoSaturation:1,needBlur:!1}},makeMSAA:o,makePipelineSettings:function(){return{msaa:o(),enableShadingScale:!1,shadingScale:.5,depthOfField:{enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1},bloom:{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},toneMapping:{material:null},colorGrading:{enabled:!1,material:null,contribute:1,colorGradingMap:null},fsr:{enabled:!1,material:null,sharpness:.8},fxaa:{enabled:!1,material:null}}},makeToneMapping:function(){return{material:null}}}),a._RF.push({},"cbf30kCUX9A3K+QpVC6wnzx","builtin-pipeline-types",void 0);var i=t.SampleCount;function o(){return{enabled:!1,sampleCount:i.X4}}function s(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.sampleCount&&(e.sampleCount=i.X4)}function r(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.focusDistance&&(e.focusDistance=0),void 0===e.focusRange&&(e.focusRange=0),void 0===e.bokehRadius&&(e.bokehRadius=1)}function n(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.enableAlphaMask&&(e.enableAlphaMask=!1),void 0===e.iterations&&(e.iterations=3),void 0===e.threshold&&(e.threshold=.8),void 0===e.intensity&&(e.intensity=2.3)}function l(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.contribute&&(e.contribute=1),void 0===e.colorGradingMap&&(e.colorGradingMap=null)}function d(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.sharpness&&(e.sharpness=.8)}function c(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null)}function h(e){void 0===e.material&&(e.material=null)}a._RF.pop()}}})),System.register("chunks:///_virtual/builtin-pipeline.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./builtin-pipeline-types.ts"],(function(){var e,a,t,i,o,s,r,n,l,d,c,h,p,g,u,f,m,_;return{setters:[function(a){e=a.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,t=e.geometry,i=e.gfx,o=e.renderer,s=e.rendering,r=e.Vec3,n=e.Vec4,l=e.Vec2,d=e.Material,c=e.PipelineEventType,h=e.assert,p=e.clamp,g=e.sys,u=e.pipeline,f=e.Layers},function(e){m=e.DEBUG},function(e){_=e.makePipelineSettings}],execute:function(){a._RF.push({},"ff9b0GZzgRM/obMbHGfCNbk","builtin-pipeline",void 0);var b=t.AABB,S=t.Sphere,P=t.intersect,R=i.ClearFlagBit,M=i.Color,y=i.Format,w=i.FormatFeatureBit,T=i.LoadOp,C=i.StoreOp,E=i.TextureType,v=i.Viewport,x=o.scene,D=x.CameraUsage,A=x.CSMLevel,F=x.LightType;function O(e){return!!(e.clearFlag&(R.COLOR|R.STENCIL<<1))}function L(e,a,t,i,o,s){e.shadowFixedArea||e.csmLevel===A.LEVEL_1?(o.left=0,o.top=0,o.width=Math.trunc(a),o.height=Math.trunc(t)):(o.left=Math.trunc(i%2*.5*a),o.top=s>0?Math.trunc(.5*(1-Math.floor(i/2))*t):Math.trunc(.5*Math.floor(i/2)*t),o.width=Math.trunc(.5*a),o.height=Math.trunc(.5*t)),o.left=Math.max(0,o.left),o.top=Math.max(0,o.top),o.width=Math.max(1,o.width),o.height=Math.max(1,o.height)}var k=function(){this.isWeb=!1,this.isWebGL1=!1,this.isWebGPU=!1,this.isMobile=!1,this.isHDR=!1,this.useFloatOutput=!1,this.toneMappingType=0,this.shadowEnabled=!1,this.shadowMapFormat=y.R32F,this.shadowMapSize=new l(1,1),this.usePlanarShadow=!1,this.screenSpaceSignY=1,this.supportDepthSample=!1,this.mobileMaxSpotLightShadowMaps=1,this.platform=new n(0,0,0,0)};function B(e,a){var t=w.SAMPLED_TEXTURE|w.LINEAR_FILTER,s=e.device;a.isWeb=!g.isNative,a.isWebGL1=s.gfxAPI===i.API.WEBGL,a.isWebGPU=s.gfxAPI===i.API.WEBGPU,a.isMobile=g.isMobile,a.isHDR=e.pipelineSceneData.isHDR,a.useFloatOutput=e.getMacroBool("CC_USE_FLOAT_OUTPUT"),a.toneMappingType=e.pipelineSceneData.postSettings.toneMappingType;var r=e.pipelineSceneData.shadows;a.shadowEnabled=r.enabled,a.shadowMapFormat=u.supportsR32FloatTexture(e.device)?y.R32F:y.RGBA8,a.shadowMapSize.set(r.size),a.usePlanarShadow=r.enabled&&r.type===o.scene.ShadowType.Planar,a.screenSpaceSignY=e.device.capabilities.screenSpaceSignY,a.supportDepthSample=(e.device.getFormatFeatures(y.DEPTH_STENCIL)&t)===t;var n=s.capabilities.screenSpaceSignY;a.platform.x=a.isMobile?1:0,a.platform.w=.5*n+.5<<1|.5*s.capabilities.clipSpaceSignY+.5}var G=_(),N=function(){this.colorName="",this.depthStencilName="",this.enableMainLightShadowMap=!1,this.enableMainLightPlanarShadowMap=!1,this.enablePostProcess=!1,this.enableProfiler=!1,this.enableShadingScale=!1,this.enableMSAA=!1,this.enableDOF=!1,this.enableBloom=!1,this.enableColorGrading=!1,this.enableFXAA=!1,this.enableFSR=!1,this.enableHDR=!1,this.enablePlanarReflectionProbe=!1,this.useFullPipeline=!1,this.singleForwardRadiancePass=!1,this.radianceFormat=i.Format.RGBA8,this.shadingScale=.5,this.settings=G};function z(e,a,t){t.enableDOF=e.supportDepthSample&&a.depthOfField.enabled&&!!a.depthOfField.material,t.enableBloom=a.bloom.enabled&&!!a.bloom.material,t.enableColorGrading=a.colorGrading.enabled&&!!a.colorGrading.material&&!!a.colorGrading.colorGradingMap,t.enableFXAA=a.fxaa.enabled&&!!a.fxaa.material,t.enablePostProcess=t.enableDOF||t.enableBloom||t.enableColorGrading||t.enableFXAA}function Q(e,a,t){var o=e.window,r=e.cameraUsage===D.GAME&&!!o.swapchain,n=e.cameraUsage===D.SCENE_VIEW||e.cameraUsage===D.PREVIEW;if(t.colorName=o.colorName,t.depthStencilName=o.depthStencilName,t.useFullPipeline=0!=(e.visibility&f.Enum.DEFAULT),t.enableMainLightShadowMap=a.shadowEnabled&&!a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enableMainLightPlanarShadowMap=a.shadowEnabled&&a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enablePlanarReflectionProbe=r||e.cameraUsage===D.SCENE_VIEW,t.enableProfiler=m,t.settings=e.pipelineSettings?e.pipelineSettings:G,z(a,t.settings,t),n){var l=s.getEditorPipelineSettings();l&&(t.settings=l,z(a,t.settings,t))}t.enableMSAA=t.settings.msaa.enabled&&!a.isWeb&&!a.isWebGL1,t.shadingScale=t.settings.shadingScale,t.enableShadingScale=t.settings.enableShadingScale&&1!==t.shadingScale,t.enableFSR=t.settings.fsr.enabled&&!!t.settings.fsr.material&&t.enableShadingScale&&t.shadingScale<1,t.singleForwardRadiancePass=a.isMobile||t.enableMSAA,t.enableHDR=t.useFullPipeline&&a.useFloatOutput,t.radianceFormat=t.enableHDR?i.Format.RGBA16F:i.Format.RGBA8}if(s){var I=s.QueueHint,H=s.SceneFlags,U=s.ResourceFlags,V=s.ResourceResidency,W=function(){function a(){this.lights=[],this.shadowEnabledSpotLights=[],this._sphere=S.create(0,0,0,1),this._boundingBox=new b,this._rangedDirLightBoundingBox=new b(0,0,0,.5,.5,.5)}var t=a.prototype;return t.cullLights=function(a,t,i){this.lights.length=0,this.shadowEnabledSpotLights.length=0;for(var o,s=e(a.spotLights);!(o=s()).done;){var n=o.value;n.baked||(S.set(this._sphere,n.position.x,n.position.y,n.position.z,n.range),P.sphereFrustum(this._sphere,t)&&(n.shadowEnabled?this.shadowEnabledSpotLights.push(n):this.lights.push(n)))}for(var l,d=e(a.sphereLights);!(l=d()).done;){var c=l.value;c.baked||(S.set(this._sphere,c.position.x,c.position.y,c.position.z,c.range),P.sphereFrustum(this._sphere,t)&&this.lights.push(c))}for(var h,p=e(a.pointLights);!(h=p()).done;){var g=h.value;g.baked||(S.set(this._sphere,g.position.x,g.position.y,g.position.z,g.range),P.sphereFrustum(this._sphere,t)&&this.lights.push(g))}for(var u,f=e(a.rangedDirLights);!(u=f()).done;){var m=u.value;b.transform(this._boundingBox,this._rangedDirLightBoundingBox,m.node.getWorldMatrix()),P.aabbFrustum(this._boundingBox,t)&&this.lights.push(m)}i&&this.shadowEnabledSpotLights.sort((function(e,a){return r.squaredDistance(i,e.position)-r.squaredDistance(i,a.position)}))},t._addLightQueues=function(a,t){for(var i,o=e(this.lights);!(i=o()).done;){var s=i.value,r=t.addQueue(I.BLEND,"forward-add");switch(s.type){case F.SPHERE:r.name="sphere-light";break;case F.SPOT:r.name="spot-light";break;case F.POINT:r.name="point-light";break;case F.RANGED_DIRECTIONAL:r.name="ranged-directional-light";break;default:r.name="unknown-light"}r.addScene(a,H.BLEND,s)}},t.addSpotlightShadowPasses=function(a,t,i){for(var o,s=0,r=e(this.shadowEnabledSpotLights);!(o=r()).done;){var n=o.value,l=a.pipelineSceneData.shadows.size,d=a.addRenderPass(l.x,l.y,"default");if(d.name="SpotLightShadowPass"+s,d.addRenderTarget("SpotShadowMap"+s,T.CLEAR,C.STORE,new M(1,1,1,1)),d.addDepthStencil("SpotShadowDepth"+s,T.CLEAR,C.DISCARD),d.addQueue(I.NONE,"shadow-caster").addScene(t,H.OPAQUE|H.MASK|H.SHADOW_CASTER).useLightFrustum(n),++s>=i)break}},t.addLightQueues=function(a,t,i){this._addLightQueues(t,a);for(var o,s=0,r=e(this.shadowEnabledSpotLights);!(o=r()).done;){var n=o.value;if(a.addTexture("SpotShadowMap"+s,"cc_spotShadowMap"),a.addQueue(I.BLEND,"forward-add").addScene(t,H.BLEND,n),++s>=i)break}},t.addLightPasses=function(a,t,i,o,s,r,n,l,d,c){this._addLightQueues(n,c);for(var h,p=0,g=d.pipelineSceneData.shadows.size,u=e(this.shadowEnabledSpotLights);!(h=u()).done;){var f=h.value,m=d.addRenderPass(g.x,g.y,"default");m.name="SpotlightShadowPass",m.addRenderTarget("ShadowMap"+o,T.CLEAR,C.STORE,new M(1,1,1,1)),m.addDepthStencil("ShadowDepth"+o,T.CLEAR,C.DISCARD),m.addQueue(I.NONE,"shadow-caster").addScene(n,H.OPAQUE|H.MASK|H.SHADOW_CASTER).useLightFrustum(f);var _=++p===this.shadowEnabledSpotLights.length?i:C.STORE;(c=d.addRenderPass(s,r,"default")).name="SpotlightWithShadowMap",c.setViewport(l),c.addRenderTarget(a,T.LOAD),c.addDepthStencil(t,T.LOAD,_),c.addTexture("ShadowMap"+o,"cc_spotShadowMap"),c.addQueue(I.BLEND,"forward-add").addScene(n,H.BLEND,f)}return c},t.isMultipleLightPassesNeeded=function(){return this.shadowEnabledSpotLights.length>0},a}(),j=function(){function t(){this._pipelineEvent=a.director.root.pipelineEvent,this._clearColor=new M(0,0,0,1),this._clearColorTransparentBlack=new M(0,0,0,0),this._reflectionProbeClearColor=new r(0,0,0),this._viewport=new v,this._configs=new k,this._cameraConfigs=new N,this._cocParams=new n(0,0,0,0),this._cocTexSize=new n(0,0,0,0),this._bloomParams=new n(0,0,0,0),this._bloomTexSize=new n(0,0,0,0),this._bloomWidths=[],this._bloomHeights=[],this._bloomTexNames=[],this._colorGradingTexSize=new l(0,0),this._fxaaParams=new n(0,0,0,0),this._fsrParams=new n(0,0,0,0),this._fsrTexSize=new n(0,0,0,0),this._copyAndTonemapMaterial=new d,this._initialized=!1,this.forwardLighting=new W}var g=t.prototype;return g.windowResize=function(e,a,t,i,o){B(e,this._configs),Q(t,this._configs,this._cameraConfigs);var s=this._cameraConfigs.settings,r=a.renderWindowId,n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(i*this._cameraConfigs.shadingScale),1):i,l=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(o*this._cameraConfigs.shadingScale),1):o;if(e.addRenderWindow(this._cameraConfigs.colorName,y.RGBA8,i,o,a,this._cameraConfigs.depthStencilName),this._cameraConfigs.enableShadingScale?(e.addDepthStencil("ScaledSceneDepth"+r,y.DEPTH_STENCIL,n,l),e.addRenderTarget("ScaledRadiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("ScaledLdrColor"+r,y.RGBA8,n,l)):(e.addDepthStencil("SceneDepth"+r,y.DEPTH_STENCIL,n,l),e.addRenderTarget("Radiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("LdrColor"+r,y.RGBA8,n,l)),this._cameraConfigs.enableFSR&&e.addRenderTarget("FsrColor"+r,y.RGBA8,i,o),this._cameraConfigs.enableMSAA&&(this._cameraConfigs.enableHDR?e.addTexture("MsaaRadiance"+r,E.TEX2D,this._cameraConfigs.radianceFormat,n,l,1,1,1,s.msaa.sampleCount,U.COLOR_ATTACHMENT,V.MEMORYLESS):e.addTexture("MsaaRadiance"+r,E.TEX2D,y.RGBA8,n,l,1,1,1,s.msaa.sampleCount,U.COLOR_ATTACHMENT,V.MEMORYLESS),e.addTexture("MsaaDepthStencil"+r,E.TEX2D,y.DEPTH_STENCIL,n,l,1,1,1,s.msaa.sampleCount,U.DEPTH_STENCIL_ATTACHMENT,V.MEMORYLESS)),e.addRenderTarget("ShadowMap"+r,this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("ShadowDepth"+r,y.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),this._cameraConfigs.singleForwardRadiancePass)for(var d=this._configs.mobileMaxSpotLightShadowMaps,c=0;c!==d;++c)e.addRenderTarget("SpotShadowMap"+c,this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("SpotShadowDepth"+c,y.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y);if(this._cameraConfigs.enableDOF){var h=Math.max(Math.floor(n/2),1),p=Math.max(Math.floor(l/2),1);e.addRenderTarget("DofRadiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("DofPrefilter"+r,this._cameraConfigs.radianceFormat,h,p),e.addRenderTarget("DofBokeh"+r,this._cameraConfigs.radianceFormat,h,p),e.addRenderTarget("DofFilter"+r,this._cameraConfigs.radianceFormat,h,p)}if(this._cameraConfigs.enableBloom)for(var g=n,u=l,f=0;f!==s.bloom.iterations+1;++f)g=Math.max(Math.floor(g/2),1),u=Math.max(Math.floor(u/2),1),e.addRenderTarget("BloomTex"+r+"_"+f,this._cameraConfigs.radianceFormat,g,u);this._cameraConfigs.enableColorGrading&&s.colorGrading.material&&s.colorGrading.colorGradingMap&&s.colorGrading.material.setProperty("colorGradingMap",s.colorGrading.colorGradingMap),this._cameraConfigs.enableFXAA&&this._cameraConfigs.enableShadingScale&&e.addRenderTarget("AaColor"+r,y.RGBA8,n,l)},g.setup=function(a,t){if(!this._initMaterials(t))for(var i,o=e(a);!(i=o()).done;){var s=i.value;s.scene&&s.window&&(Q(s,this._configs,this._cameraConfigs),this._pipelineEvent.emit(c.RENDER_CAMERA_BEGIN,s),this._cameraConfigs.useFullPipeline?this._buildForwardPipeline(t,s,s.scene):this._buildSimplePipeline(t,s),this._pipelineEvent.emit(c.RENDER_CAMERA_END,s))}},g._buildSimplePipeline=function(e,a){var t=Math.max(Math.floor(a.window.width),1),i=Math.max(Math.floor(a.window.height),1),o=this._cameraConfigs.colorName,s=this._cameraConfigs.depthStencilName,r=a.viewport;this._viewport.left=Math.round(r.x*t),this._viewport.top=Math.round(r.y*i),this._viewport.width=Math.max(Math.round(r.width*t),1),this._viewport.height=Math.max(Math.round(r.height*i),1);var n=a.clearColor;this._clearColor.x=n.x,this._clearColor.y=n.y,this._clearColor.z=n.z,this._clearColor.w=n.w;var l=e.addRenderPass(t,i,"default");O(a)?l.addRenderTarget(o,T.CLEAR,C.STORE,this._clearColor):l.addRenderTarget(o,T.LOAD,C.STORE),a.clearFlag&R.DEPTH_STENCIL?l.addDepthStencil(s,T.CLEAR,C.DISCARD,a.clearDepth,a.clearStencil,a.clearFlag&R.DEPTH_STENCIL):l.addDepthStencil(s,T.LOAD,C.DISCARD),l.setViewport(this._viewport),l.addQueue(I.OPAQUE).addScene(a,H.OPAQUE);var d=H.BLEND|H.UI;this._cameraConfigs.enableProfiler&&(d|=H.PROFILER,l.showStatistics=!0),l.addQueue(I.BLEND).addScene(a,d)},g._buildForwardPipeline=function(e,a,t){var i,o=this._cameraConfigs.settings,s=Math.max(Math.floor(a.window.width),1),r=Math.max(Math.floor(a.window.height),1),n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(s*this._cameraConfigs.shadingScale),1):s,l=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(r*this._cameraConfigs.shadingScale),1):r,d=a.window.renderWindowId,c=this._cameraConfigs.colorName,p=this._cameraConfigs.enableShadingScale?"ScaledSceneDepth"+d:"SceneDepth"+d,g=this._cameraConfigs.enableShadingScale?"ScaledRadiance"+d:"Radiance"+d,u=this._cameraConfigs.enableShadingScale?"ScaledLdrColor"+d:"LdrColor"+d,f=t.mainLight;if(this.forwardLighting.cullLights(t,a.frustum),this._cameraConfigs.enableMainLightShadowMap&&(h(!!f),this._addCascadedShadowMapPass(e,d,f,a)),this._cameraConfigs.singleForwardRadiancePass&&this.forwardLighting.addSpotlightShadowPasses(e,a,this._configs.mobileMaxSpotLightShadowMaps),this._tryAddReflectionProbePasses(e,d,f,a.scene),this._cameraConfigs.enablePostProcess){if(this._cameraConfigs.enableDOF){h(!!o.depthOfField.material);var m="DofRadiance"+d;this._addForwardRadiancePasses(e,d,a,n,l,f,m,p,!0,C.STORE),this._addDepthOfFieldPasses(e,o,o.depthOfField.material,d,a,n,l,m,p,g,u)}else this._addForwardRadiancePasses(e,d,a,n,l,f,g,p);if(this._cameraConfigs.enableBloom&&(h(!!o.bloom.material),this._addKawaseDualFilterBloomPasses(e,o,o.bloom.material,d,n,l,g)),this._cameraConfigs.enableFXAA){h(!!o.fxaa.material);var _=this._cameraConfigs.enableHDR||this._cameraConfigs.enableColorGrading,b=_?u:g;if(_&&this._addCopyAndTonemapPass(e,o,n,l,g,b),this._cameraConfigs.enableShadingScale){var S="AaColor"+d;this._addFxaaPass(e,o.fxaa.material,n,l,b,S),i=this._cameraConfigs.enableFSR&&o.fsr.material?this._addFsrPass(e,o,o.fsr.material,d,n,l,S,s,r,c):this._addCopyPass(e,s,r,S,c)}else i=this._addFxaaPass(e,o.fxaa.material,s,r,b,c)}else i=this._addTonemapResizeOrSuperResolutionPasses(e,o,d,n,l,g,u,s,r,c)}else this._cameraConfigs.enableHDR||this._cameraConfigs.enableShadingScale?(this._addForwardRadiancePasses(e,d,a,n,l,f,g,p),i=this._addTonemapResizeOrSuperResolutionPasses(e,o,d,n,l,g,u,s,r,c)):i=this._addForwardRadiancePasses(e,d,a,s,r,f,c,this._cameraConfigs.depthStencilName);this._addUIQueue(a,i)},g._addTonemapResizeOrSuperResolutionPasses=function(e,a,t,i,o,s,r,n,l,d){var c;return this._cameraConfigs.enableFSR&&a.fsr.material?(this._addCopyAndTonemapPass(e,a,i,o,s,r),c=this._addFsrPass(e,a,a.fsr.material,t,i,o,r,n,l,d)):c=this._addCopyAndTonemapPass(e,a,n,l,s,d),c},g._addCascadedShadowMapPass=function(e,a,t,i){var o=e.pipelineSceneData.shadows.size.x,s=e.pipelineSceneData.shadows.size.y;this._viewport.left=0,this._viewport.top=0,this._viewport.width=o,this._viewport.height=s;var r=e.addRenderPass(o,s,"default");r.name="CascadedShadowMap",r.addRenderTarget("ShadowMap"+a,T.CLEAR,C.STORE,new M(1,1,1,1)),r.addDepthStencil("ShadowDepth"+a,T.CLEAR,C.DISCARD);for(var n=e.pipelineSceneData.csmSupported?t.csmLevel:1,l=0;l!==n;++l){L(t,o,s,l,this._viewport,this._configs.screenSpaceSignY);var d=r.addQueue(I.NONE,"shadow-caster");this._configs.isWebGPU||d.setViewport(this._viewport),d.addScene(i,H.OPAQUE|H.MASK|H.SHADOW_CASTER).useLightFrustum(t,l)}},g._addCopyPass=function(e,a,t,i,o){var s=e.addRenderPass(a,t,"cc-tone-mapping");return s.addRenderTarget(o,T.CLEAR,C.STORE,this._clearColorTransparentBlack),s.addTexture(i,"inputTexture"),s.setVec4("g_platform",this._configs.platform),s.addQueue(I.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,1),s},g._addCopyAndTonemapPass=function(e,a,t,i,o,s){var r;if(this._cameraConfigs.enableColorGrading&&a.colorGrading.material&&a.colorGrading.colorGradingMap){var n=a.colorGrading.colorGradingMap;this._colorGradingTexSize.x=n.width,this._colorGradingTexSize.y=n.height;var l=n.width===n.height;(r=l?e.addRenderPass(t,i,"cc-color-grading-8x8"):e.addRenderPass(t,i,"cc-color-grading-nx1")).addRenderTarget(s,T.CLEAR,C.STORE,this._clearColorTransparentBlack),r.addTexture(o,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec2("lutTextureSize",this._colorGradingTexSize),r.setFloat("contribute",a.colorGrading.contribute),r.addQueue(I.OPAQUE).addFullscreenQuad(a.colorGrading.material,l?1:0)}else(r=e.addRenderPass(t,i,"cc-tone-mapping")).addRenderTarget(s,T.CLEAR,C.STORE,this._clearColorTransparentBlack),r.addTexture(o,"inputTexture"),r.setVec4("g_platform",this._configs.platform),a.toneMapping.material?r.addQueue(I.OPAQUE).addFullscreenQuad(a.toneMapping.material,0):r.addQueue(I.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,0);return r},g._buildForwardMainLightPass=function(e,a,t,i,o,s,r,n){void 0===n&&(n=null),e.setViewport(this._viewport);var l=this._cameraConfigs.enableMSAA?C.DISCARD:C.STORE;O(t)?e.addRenderTarget(i,T.CLEAR,l,this._clearColor):e.addRenderTarget(i,T.LOAD,l),t.clearFlag&R.DEPTH_STENCIL?e.addDepthStencil(o,T.CLEAR,s,t.clearDepth,t.clearStencil,t.clearFlag&R.DEPTH_STENCIL):e.addDepthStencil(o,T.LOAD,s),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(I.NONE).addScene(t,H.OPAQUE|H.MASK,r||void 0,n||void 0)},g._addDepthOfFieldPasses=function(e,a,t,i,o,s,r,n,l,d,c){this._cocParams.x=a.depthOfField.focusDistance,this._cocParams.y=a.depthOfField.focusRange,this._cocParams.z=a.depthOfField.bokehRadius,this._cocParams.w=0,this._cocTexSize.x=1/s,this._cocTexSize.y=1/r,this._cocTexSize.z=s,this._cocTexSize.w=r;var h=Math.max(Math.floor(s/2),1),p=Math.max(Math.floor(r/2),1),g=c,u="DofPrefilter"+i,f="DofBokeh"+i,m="DofFilter"+i,_=e.addRenderPass(s,r,"cc-dof-coc");_.addRenderTarget(g,T.CLEAR,C.STORE,this._clearColorTransparentBlack),_.addTexture(l,"DepthTex"),_.setVec4("g_platform",this._configs.platform),_.setMat4("proj",o.matProj),_.setVec4("cocParams",this._cocParams),_.addQueue(I.OPAQUE).addCameraQuad(o,t,0);var b=e.addRenderPass(h,p,"cc-dof-prefilter");b.addRenderTarget(u,T.CLEAR,C.STORE,this._clearColorTransparentBlack),b.addTexture(n,"colorTex"),b.addTexture(g,"cocTex"),b.setVec4("g_platform",this._configs.platform),b.setVec4("mainTexTexelSize",this._cocTexSize),b.addQueue(I.OPAQUE).addFullscreenQuad(t,1);var S=e.addRenderPass(h,p,"cc-dof-bokeh");S.addRenderTarget(f,T.CLEAR,C.STORE,this._clearColorTransparentBlack),S.addTexture(u,"prefilterTex"),S.setVec4("g_platform",this._configs.platform),S.setVec4("mainTexTexelSize",this._cocTexSize),S.setVec4("cocParams",this._cocParams),S.addQueue(I.OPAQUE).addFullscreenQuad(t,2);var P=e.addRenderPass(h,p,"cc-dof-filter");P.addRenderTarget(m,T.CLEAR,C.STORE,this._clearColorTransparentBlack),P.addTexture(f,"bokehTex"),P.setVec4("g_platform",this._configs.platform),P.setVec4("mainTexTexelSize",this._cocTexSize),P.addQueue(I.OPAQUE).addFullscreenQuad(t,3);var R=e.addRenderPass(s,r,"cc-dof-combine");R.addRenderTarget(d,T.CLEAR,C.STORE,this._clearColorTransparentBlack),R.addTexture(n,"colorTex"),R.addTexture(g,"cocTex"),R.addTexture(m,"filterTex"),R.setVec4("g_platform",this._configs.platform),R.setVec4("cocParams",this._cocParams),R.addQueue(I.OPAQUE).addFullscreenQuad(t,4)},g._addKawaseDualFilterBloomPasses=function(e,a,t,i,o,s,r){var n=a.bloom.iterations,l=n+1;this._bloomWidths.length=l,this._bloomHeights.length=l,this._bloomWidths[0]=Math.max(Math.floor(o/2),1),this._bloomHeights[0]=Math.max(Math.floor(s/2),1);for(var d=1;d!==l;++d)this._bloomWidths[d]=Math.max(Math.floor(this._bloomWidths[d-1]/2),1),this._bloomHeights[d]=Math.max(Math.floor(this._bloomHeights[d-1]/2),1);this._bloomTexNames.length=l;for(var c=0;c!==l;++c)this._bloomTexNames[c]="BloomTex"+i+"_"+c;this._bloomParams.x=this._configs.useFloatOutput?1:0,this._bloomParams.x=0,this._bloomParams.z=a.bloom.threshold,this._bloomParams.w=a.bloom.enableAlphaMask?1:0;var h=e.addRenderPass(this._bloomWidths[0],this._bloomHeights[0],"cc-bloom-prefilter");h.addRenderTarget(this._bloomTexNames[0],T.CLEAR,C.STORE,this._clearColorTransparentBlack),h.addTexture(r,"inputTexture"),h.setVec4("g_platform",this._configs.platform),h.setVec4("bloomParams",this._bloomParams),h.addQueue(I.OPAQUE).addFullscreenQuad(t,0);for(var p=1;p!==l;++p){var g=e.addRenderPass(this._bloomWidths[p],this._bloomHeights[p],"cc-bloom-downsample");g.addRenderTarget(this._bloomTexNames[p],T.CLEAR,C.STORE,this._clearColorTransparentBlack),g.addTexture(this._bloomTexNames[p-1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[p-1],this._bloomTexSize.y=this._bloomHeights[p-1],g.setVec4("g_platform",this._configs.platform),g.setVec4("bloomTexSize",this._bloomTexSize),g.addQueue(I.OPAQUE).addFullscreenQuad(t,1)}for(var u=n;u-- >0;){var f=e.addRenderPass(this._bloomWidths[u],this._bloomHeights[u],"cc-bloom-upsample");f.addRenderTarget(this._bloomTexNames[u],T.CLEAR,C.STORE,this._clearColorTransparentBlack),f.addTexture(this._bloomTexNames[u+1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[u+1],this._bloomTexSize.y=this._bloomHeights[u+1],f.setVec4("g_platform",this._configs.platform),f.setVec4("bloomTexSize",this._bloomTexSize),f.addQueue(I.OPAQUE).addFullscreenQuad(t,2)}var m=e.addRenderPass(o,s,"cc-bloom-combine");m.addRenderTarget(r,T.LOAD,C.STORE),m.addTexture(this._bloomTexNames[0],"bloomTexture"),m.setVec4("g_platform",this._configs.platform),m.setVec4("bloomParams",this._bloomParams),m.addQueue(I.BLEND).addFullscreenQuad(t,3)},g._addFsrPass=function(e,a,t,i,o,s,r,n,l,d){this._fsrTexSize.x=o,this._fsrTexSize.y=s,this._fsrTexSize.z=n,this._fsrTexSize.w=l,this._fsrParams.x=p(1-a.fsr.sharpness,.02,.98);var c="FsrColor"+i,h=e.addRenderPass(n,l,"cc-fsr-easu");h.addRenderTarget(c,T.CLEAR,C.STORE,this._clearColorTransparentBlack),h.addTexture(r,"outputResultMap"),h.setVec4("g_platform",this._configs.platform),h.setVec4("fsrTexSize",this._fsrTexSize),h.addQueue(I.OPAQUE).addFullscreenQuad(t,0);var g=e.addRenderPass(n,l,"cc-fsr-rcas");return g.addRenderTarget(d,T.CLEAR,C.STORE,this._clearColorTransparentBlack),g.addTexture(c,"outputResultMap"),g.setVec4("g_platform",this._configs.platform),g.setVec4("fsrTexSize",this._fsrTexSize),g.setVec4("fsrParams",this._fsrParams),g.addQueue(I.OPAQUE).addFullscreenQuad(t,1),g},g._addFxaaPass=function(e,a,t,i,o,s){this._fxaaParams.x=t,this._fxaaParams.y=i,this._fxaaParams.z=1/t,this._fxaaParams.w=1/i;var r=e.addRenderPass(t,i,"cc-fxaa");return r.addRenderTarget(s,T.CLEAR,C.STORE,this._clearColorTransparentBlack),r.addTexture(o,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec4("texSize",this._fxaaParams),r.addQueue(I.OPAQUE).addFullscreenQuad(a,0),r},g._addUIQueue=function(e,a){var t=H.UI;this._cameraConfigs.enableProfiler&&(t|=H.PROFILER,a.showStatistics=!0),a.addQueue(I.BLEND,"default","default").addScene(e,t)},g._addForwardRadiancePasses=function(e,a,t,i,o,s,r,n,l,d){void 0===l&&(l=!1),void 0===d&&(d=C.DISCARD);var c=t.clearColor;this._clearColor.x=c.x,this._clearColor.y=c.y,this._clearColor.z=c.z,this._clearColor.w=c.w;var p=t.viewport;this._viewport.left=Math.round(p.x*i),this._viewport.top=Math.round(p.y*o),this._viewport.width=Math.max(Math.round(p.width*i),1),this._viewport.height=Math.max(Math.round(p.height*o),1);var g=!l&&this._cameraConfigs.enableMSAA;h(!g||this._cameraConfigs.singleForwardRadiancePass);var u=this._cameraConfigs.singleForwardRadiancePass?this._addForwardSingleRadiancePass(e,a,t,g,i,o,s,r,n,d):this._addForwardMultipleRadiancePasses(e,a,t,i,o,s,r,n,d);this._cameraConfigs.enableMainLightPlanarShadowMap&&this.addPlanarShadowQueue(t,s,u);var f=H.BLEND|(t.geometryRenderer?H.GEOMETRY:H.NONE);return u.addQueue(I.BLEND).addScene(t,f,s||void 0),u},g._addForwardSingleRadiancePass=function(e,a,t,i,o,s,r,n,l,d){var c;if(h(this._cameraConfigs.singleForwardRadiancePass),i){var p="MsaaRadiance"+a,g="MsaaDepthStencil"+a,u=this._cameraConfigs.settings.msaa.sampleCount,f=e.addMultisampleRenderPass(o,s,u,0,"default");f.name="MsaaForwardPass",this._buildForwardMainLightPass(f,a,t,p,g,C.DISCARD,r),f.resolveRenderTarget(p,n),c=f}else(c=e.addRenderPass(o,s,"default")).name="ForwardPass",this._buildForwardMainLightPass(c,a,t,n,l,d,r);return h(void 0!==c),this.forwardLighting.addLightQueues(c,t,this._configs.mobileMaxSpotLightShadowMaps),c},g.addPlanarShadowQueue=function(e,a,t){t.addQueue(I.BLEND,"planar-shadow").addScene(e,H.SHADOW_CASTER|H.PLANAR_SHADOW|H.BLEND,a||void 0)},g._addForwardMultipleRadiancePasses=function(e,a,t,i,o,s,r,n,l){h(!this._cameraConfigs.singleForwardRadiancePass);var d=e.addRenderPass(i,o,"default");d.name="ForwardPass";var c=this.forwardLighting.isMultipleLightPassesNeeded()?C.STORE:l;return this._buildForwardMainLightPass(d,a,t,r,n,c,s),this.forwardLighting.addLightPasses(r,n,l,a,i,o,t,this._viewport,e,d)},g._buildReflectionProbePass=function(e,a,t,i,o,r,n){void 0===n&&(n=null);var l=this._cameraConfigs.enableMSAA?C.DISCARD:C.STORE;if(O(t)){this._reflectionProbeClearColor.x=t.clearColor.x,this._reflectionProbeClearColor.y=t.clearColor.y,this._reflectionProbeClearColor.z=t.clearColor.z;var d=s.packRGBE(this._reflectionProbeClearColor);this._clearColor.x=d.x,this._clearColor.y=d.y,this._clearColor.z=d.z,this._clearColor.w=d.w,e.addRenderTarget(i,T.CLEAR,l,this._clearColor)}else e.addRenderTarget(i,T.LOAD,l);t.clearFlag&R.DEPTH_STENCIL?e.addDepthStencil(o,T.CLEAR,C.DISCARD,t.clearDepth,t.clearStencil,t.clearFlag&R.DEPTH_STENCIL):e.addDepthStencil(o,T.LOAD,C.DISCARD),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(I.NONE,"reflect-map").addScene(t,H.OPAQUE|H.MASK|H.REFLECTION_PROBE,r||void 0,n||void 0)},g._tryAddReflectionProbePasses=function(t,s,r,n){var l=a.internal.reflectionProbeManager;if(l)for(var d,c=l.getProbes(),h=0,p=e(c);!(d=p()).done;){var g=d.value;if(g.needRender){var u=g.renderArea(),f=Math.max(Math.floor(u.x),1),m=Math.max(Math.floor(u.y),1);if(g.probeType===o.scene.ProbeType.PLANAR){if(!this._cameraConfigs.enablePlanarReflectionProbe)continue;var _=g.realtimePlanarTexture.window,b="PlanarProbeRT"+h,S="PlanarProbeDS"+h;t.addRenderWindow(b,this._cameraConfigs.radianceFormat,f,m,_),t.addDepthStencil(S,i.Format.DEPTH_STENCIL,f,m,V.MEMORYLESS);var P=t.addRenderPass(f,m,"default");P.name="PlanarReflectionProbe"+h,this._buildReflectionProbePass(P,s,g.camera,b,S,r,n)}if(4==++h)break}}},g._initMaterials=function(e){return this._initialized?0:(B(e,this._configs),this._copyAndTonemapMaterial._uuid="builtin-pipeline-tone-mapping-material",this._copyAndTonemapMaterial.initialize({effectName:"pipeline/post-process/tone-mapping"}),this._copyAndTonemapMaterial.effectAsset&&(this._initialized=!0),this._initialized?0:1)},t}();s.setCustomPipeline("Builtin",new j)}a._RF.pop()}}})),System.register("chunks:///_virtual/internal",["./builtin-pipeline-settings.ts","./builtin-pipeline-types.ts","./builtin-pipeline.ts"],(function(){return{setters:[null,null,null],execute:function(){}}})),r="virtual:///prerequisite-imports/internal",n="chunks:///_virtual/internal",System.register(r,[n],(function(e,a){return{setters:[function(a){var t={};for(var i in a)"default"!==i&&"__esModule"!==i&&(t[i]=a[i]);e(t)}],execute:function(){}}})),e("default",i.exports)}),{})}}}));

System.register("chunks:///_virtual/index3.js",["./cjs-loader.mjs"],(function(e,t){var n;return{setters:[function(e){n=e.default}],execute:function(){e("default",void 0);var r=e("__cjsMetaURL",t.meta.url);n.define(r,(function(t,n,r,i,o){var a,s;System.register("chunks:///_virtual/FloatingText.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.Label,l=e.Color,c=e.tween,u=e.Vec3,p=e.Component}],execute:function(){var f,h,g,b;o._RF.push({},"bd2afV6GjdEioGJ6Sb+apw4","FloatingText",void 0);var d=a.ccclass,m=a.property;e("FloatingText",d("FloatingText")((g=t((h=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"duration",g,i(t)),r(t,"moveUpDistance",b,i(t)),t}return n(t,e),t.prototype.start=function(){var e=this,t=this.getComponent(s)||this.getComponentInChildren(s);t&&(t.color=new l(t.color.r,t.color.g,t.color.b,255),c(t).to(this.duration,{color:new l(t.color.r,t.color.g,t.color.b,0)}).start(),c(this.node).by(this.duration,{position:new u(0,this.moveUpDistance,0)}).call((function(){e.node.destroy()})).start())},t}(p)).prototype,"duration",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),b=t(h.prototype,"moveUpDistance",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),f=h))||f),o._RF.pop()}}})),System.register("chunks:///_virtual/FriendsPage.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.ScrollView,u=e.Prefab,p=e.Label,f=e.instantiate,h=e.Component}],execute:function(){var g,b,d,m,y,L,v,k,w,P;s._RF.push({},"829ce7RYglPV6kmQF/Wbmbm","FriendsPage",void 0);var T=l.ccclass,x=l.property;e("FriendsPage",(g=T("FriendsPage"),b=x(c),d=x(u),m=x(p),g((v=t((L=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"scrollView",v,i(t)),r(t,"friendItemPrefab",k,i(t)),r(t,"totalFriendsLabel",w,i(t)),r(t,"apiBaseUrl",P,i(t)),t.userId=777270195,t}n(t,e);var s=t.prototype;return s.start=function(){this.fetchFriends()},s.fetchFriends=function(){var e=o(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.apiBaseUrl+"/"+this.userId);case 3:if((t=e.sent).ok){e.next=9;break}if(404!==t.status){e.next=8;break}return this.totalFriendsLabel.string="У тебя пока нет друзей",e.abrupt("return");case 8:throw new Error("Network response was not ok");case 9:return e.next=11,t.json();case 11:n=e.sent,console.log("Fetched friends:",n),this.totalFriendsLabel.string="У тебя "+n.length+" друзей",this.populateFriendsList(n),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Ошибка при загрузке списка друзей:",e.t0),this.totalFriendsLabel.string="Не удалось загрузить список друзей.";case 21:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),s.populateFriendsList=function(e){var t=this,n=this.scrollView.content;console.log("Populating friends list with",e.length,"friends."),n.removeAllChildren(),e.forEach((function(e,r){console.log("Adding friend "+(r+1)+":",e);var i=f(t.friendItemPrefab);i.parent=n;var o=i.getComponentsInChildren(p);console.log("Found "+o.length+" Label components in FriendItem.");var a=null,s=null,l=null;o.forEach((function(e){var t=e.node.name;"UsernameLabel"===t?a=e:"NumberLabel"===t?s=e:"CoinsLabel"===t&&(l=e)})),a&&s&&l?(a.string=e.username,s.string=r+1+".",l.string=t.formatCoins(e.coins),console.log("Set Username: "+e.username+", Number: "+(r+1)+", Coins: "+e.coins)):(console.warn("Не удалось найти один из Label компонентов в FriendItem"),console.log("Найденные Label узлы:",o.map((function(e){return e.node.name}))))}))},s.formatCoins=function(e){return e>=1e6?Math.round(e/1e6)+"M":Math.round(e).toLocaleString()},t}(h)).prototype,"scrollView",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(L.prototype,"friendItemPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(L.prototype,"totalFriendsLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(L.prototype,"apiBaseUrl",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/referrals"}}),y=L))||y)),s._RF.pop()}}})),System.register("chunks:///_virtual/IncomeManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.Label,u=e.Component}],execute:function(){var p,f,h,g,b;s._RF.push({},"a3599luME5HILUcjWVa3vL6","IncomeManager",void 0);var d=l.ccclass,m=l.property;e("IncomeManager",(p=d("IncomeManager"),f=m(c),p((b=t((g=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"incomeLabel",b,i(t)),t.apiUrl="https://misapat.ru/api/upgrades?userId=777270195",t}n(t,e);var s=t.prototype;return s.start=function(){this.incomeLabel?this.fetchIncomeData():console.error("incomeLabel не назначен в IncomeManager.")},s.fetchIncomeData=function(){var e=o(a().mark((function e(){var t,n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.apiUrl);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: "+t.status);case 6:return e.next=8,t.json();case 8:n=e.sent,r=this.calculateTotalIncome(n),i=this.formatIncome(r),this.updateIncomeLabel(i),console.log("Общий доход: "+i),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Ошибка при получении данных с API:",e.t0),this.updateIncomeLabel("+ 0 доход в час");case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),s.calculateTotalIncome=function(e){return e.reduce((function(e,t){return e+(t.cumulative_income||0)}),0)},s.formatIncome=function(e){return e>=1e3?"+ "+(e/1e3).toFixed(0)+"K доход в час":"+ "+e+" доход в час"},s.updateIncomeLabel=function(e){this.incomeLabel.string=e},t}(u)).prototype,"incomeLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=g))||h)),s._RF.pop()}}})),System.register("chunks:///_virtual/LeadersPage.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.ScrollView,u=e.Prefab,p=e.Label,f=e.instantiate,h=e.Component}],execute:function(){var g,b,d,m,y,L,v,k,w,P,T,x,C,I;s._RF.push({},"509aaKVAOZOU4SArmn1DqkK","LeadersPage",void 0);var z=l.ccclass,F=l.property;e("LeaderBoardPage",(g=z("LeaderBoardPage"),b=F(c),d=F(u),m=F(p),y=F(p),L=F(p),g((w=t((k=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"scrollView",w,i(t)),r(t,"leaderItemPrefab",P,i(t)),r(t,"currentRankLabel",T,i(t)),r(t,"currentUsernameLabel",x,i(t)),r(t,"currentCoinsLabel",C,i(t)),r(t,"apiBaseUrl",I,i(t)),t.userId=777270195,t}n(t,e);var s=t.prototype;return s.start=function(){this.fetchLeaders()},s.fetchLeaders=function(){var e=o(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.apiBaseUrl+"?userId="+this.userId);case 3:if((t=e.sent).ok){e.next=9;break}if(404!==t.status){e.next=8;break}return console.warn("Топ-лидеров пока нет."),e.abrupt("return");case 8:throw new Error("Network response was not ok");case 9:return e.next=11,t.json();case 11:n=e.sent,console.log("Fetched leaderboard data:",n),this.populateLeadersList(n.top50),n.currentUser&&this.displayCurrentUser(n.currentUser),this.scrollView&&this.scrollView.scrollToTop(0,!1),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Ошибка при загрузке списка лидеров:",e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),s.populateLeadersList=function(e){var t=this,n=this.scrollView.content;console.log("Populating leaderboard list with",e.length,"leaders."),n.removeAllChildren(),e.forEach((function(e,r){console.log("Adding leader "+e.rank+":",e);var i=f(t.leaderItemPrefab);i.parent=n;var o=i.getComponentsInChildren(p);console.log("Found "+o.length+" Label components in LeaderItem.");var a=null,s=null,l=null;o.forEach((function(e){var t=e.node.name;"NumberLabel"===t?a=e:"UsernameLabel"===t?s=e:"CoinsLabel"===t&&(l=e)})),a&&s&&l?(a.string="#"+e.rank,s.string=e.username,l.string=t.formatCoins(e.coins),console.log("Set Number: "+e.rank+", Username: "+e.username+", Coins: "+e.coins)):(console.warn("Не удалось найти один из Label компонентов в LeaderItem"),console.log("Найденные Label узлы:",o.map((function(e){return e.node.name}))))}))},s.displayCurrentUser=function(e){this.currentRankLabel?this.currentRankLabel.string="#"+e.rank:console.warn("currentRankLabel не назначен в LeaderBoardPage."),this.currentUsernameLabel?this.currentUsernameLabel.string=""+e.username:console.warn("currentUsernameLabel не назначен в LeaderBoardPage."),this.currentCoinsLabel?this.currentCoinsLabel.string=""+this.formatCoins(e.coins):console.warn("currentCoinsLabel не назначен в LeaderBoardPage.")},s.formatCoins=function(e){return e>=1e6?Math.round(e/1e6)+"M":Math.round(e).toLocaleString("ru-RU")},t}(h)).prototype,"scrollView",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(k.prototype,"leaderItemPrefab",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(k.prototype,"currentRankLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(k.prototype,"currentUsernameLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(k.prototype,"currentCoinsLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(k.prototype,"apiBaseUrl",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/users/leaders"}}),v=k))||v)),s._RF.pop()}}})),System.register("chunks:///_virtual/main",["./SpineController.ts.ts","./FloatingText.ts","./FriendsPage.ts","./IncomeManager.ts","./LeadersPage.ts","./ReferralLinkManager.ts","./SocketManager.ts","./TabBarController.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null],execute:function(){}}})),System.register("chunks:///_virtual/ReferralLinkManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u,p,f,h,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.Node,u=e.Label,p=e.Vec3,f=e.Component,h=e.Color,g=e.tween}],execute:function(){var b,d,m,y,L,v,k,w,P,T,x,C,I;s._RF.push({},"18bc3yUuD1GYI5rJViGJcp5","ReferralLinkManager",void 0);var z=l.ccclass,F=l.property;e("ReferralLinkManager",(b=z("ReferralLinkManager"),d=F(c),m=F(c),y=F(u),L=F(u),b((w=t((k=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"generateLinkNode",w,i(t)),r(t,"copyLinkNode",P,i(t)),r(t,"referralLinkLabel",T,i(t)),r(t,"copyNotificationLabel",x,i(t)),t.referralLink="",t.userId=777270195,r(t,"animationDuration",C,i(t)),r(t,"moveUpDistance",I,i(t)),t.initialPosition=new p,t}n(t,e);var s=t.prototype;return s.start=function(){this.generateLinkNode||console.error("generateLinkNode не назначен в ReferralLinkManager."),this.copyLinkNode||console.error("copyLinkNode не назначен в ReferralLinkManager."),this.referralLinkLabel||console.error("referralLinkLabel не назначен в ReferralLinkManager."),this.copyNotificationLabel||console.error("copyNotificationLabel не назначен в ReferralLinkManager."),this.generateLinkNode&&this.generateLinkNode.on(c.EventType.TOUCH_END,this.onGenerateLinkClicked,this),this.copyLinkNode&&(this.copyLinkNode.on(c.EventType.TOUCH_END,this.onCopyLinkClicked,this),this.copyLinkNode.active=!1),this.copyNotificationLabel&&(this.copyNotificationLabel.node.active=!1,this.initialPosition=this.copyNotificationLabel.node.position.clone())},s.onGenerateLinkClicked=function(){this.referralLink=this.getReferralLink(this.userId),this.referralLinkLabel.string=this.referralLink,console.log("Реферальная ссылка создана: "+this.referralLink),this.copyLinkNode&&(this.copyLinkNode.active=!0)},s.getReferralLink=function(e){return"https://t.me/misapatStage_bot?startapp=refId"+e},s.onCopyLinkClicked=function(){var e=o(a().mark((function e(){var t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.copyNotificationLabel&&(this.copyNotificationLabel.node.active=!0,this.copyNotificationLabel.color=new h(255,255,255,255),this.copyNotificationLabel.node.setPosition(this.initialPosition.clone()),g(this.copyNotificationLabel).to(this.animationDuration,{color:new h(255,255,255,0)}).start(),g(this.copyNotificationLabel.node).by(this.animationDuration,{position:new p(0,this.moveUpDistance,0)}).call((function(){t.copyNotificationLabel.node.active=!1,t.copyNotificationLabel.color=new h(255,255,255,255),t.copyNotificationLabel.node.setPosition(t.initialPosition.clone())})).start()),this.referralLink){e.next=4;break}return console.warn("Реферальная ссылка не создана."),e.abrupt("return");case 4:return e.prev=4,e.next=7,navigator.clipboard.writeText(this.referralLink);case 7:console.log("Реферальная ссылка скопирована в буфер обмена."),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error("Не удалось скопировать ссылку: ",e.t0);case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(){return e.apply(this,arguments)}}(),t}(f)).prototype,"generateLinkNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(k.prototype,"copyLinkNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(k.prototype,"referralLinkLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(k.prototype,"copyNotificationLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(k.prototype,"animationDuration",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),I=t(k.prototype,"moveUpDistance",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),v=k))||v)),s._RF.pop()}}})),System.register("chunks:///_virtual/SocketManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.Label,l=e.ProgressBar,c=e.Color,u=e.Component}],execute:function(){var p,f,h,g,b,d,m,y,L,v,k;o._RF.push({},"a0c39VZ6j5NRrT6cxMHqDGB","SocketManager",void 0);var w=a.ccclass,P=a.property;e("SocketManager",(p=w("SocketManager"),f=P(s),h=P(l),g=P(s),b=P(s),p((y=t((m=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"coinsLabel",y,i(t)),r(t,"energyProgressBar",L,i(t)),r(t,"energyValueLabel",v,i(t)),r(t,"messagesLabel",k,i(t)),t.socket=null,t.userId=777270195,t.maxEnergy=2e3,t.currentEnergy=0,t}n(t,e);var o=t.prototype;return o.start=function(){this.coinsLabel&&this.energyProgressBar&&this.energyValueLabel&&this.messagesLabel&&(this.autoConnect(),this.showUserInfo(!1))},o.onDestroy=function(){this.socket&&this.socket.disconnect()},o.autoConnect=function(){var e=this;try{this.socket=io("https://dev.simatap.ru",{transports:["websocket"],secure:!0,rejectUnauthorized:!1}),this.socket.on("connect",(function(){e.socket.emit("register",{userId:e.userId}),e.showUserInfo(!0)})),this.socket.on("disconnect",(function(){e.showMessage("Отключено от сервера.","danger"),e.showUserInfo(!1)})),this.socket.on("energyUpdated",(function(t){e.updateEnergy(t.energy_left)})),this.socket.on("coinsUpdated",(function(t){var n=Math.round(t.coins);e.coinsLabel.string=n.toLocaleString()})),this.socket.on("tapError",(function(t){e.showMessage(t.message,"warning")})),this.socket.on("registrationError",(function(t){e.showMessage(t.message,"danger"),e.showUserInfo(!1)})),this.socket.on("connect_error",(function(t){e.showMessage("Ошибка подключения к серверу.","danger")}))}catch(e){this.showMessage("Ошибка подключения к серверу.","danger")}},o.onTap=function(){this.userId?this.socket&&this.socket.connected?(this.socket.emit("tap",{userId:this.userId}),this.showMessage("Тап отправлен!","info")):this.showMessage("Соединение с сервером отсутствует.","danger"):this.showMessage("Пользователь не подключен.","danger")},o.showMessage=function(e,t){if(void 0===t&&(t="info"),this.messagesLabel)switch(this.messagesLabel.string=e,t){case"success":this.messagesLabel.node.color=new c(0,255,0);break;case"danger":this.messagesLabel.node.color=new c(255,0,0);break;case"warning":this.messagesLabel.node.color=new c(255,165,0);break;default:this.messagesLabel.node.color=new c(255,255,255)}},o.showUserInfo=function(e){this.coinsLabel&&this.energyProgressBar&&this.energyValueLabel&&(this.coinsLabel.node.active=e,this.energyProgressBar.node.active=e,this.energyValueLabel.node.active=e)},o.updateEnergy=function(e){e=Math.max(0,Math.min(this.maxEnergy,e)),this.currentEnergy=e;var t=e/this.maxEnergy;this.energyProgressBar.progress=t,this.energyValueLabel.string=e+"/"+this.maxEnergy},o.getCurrentEnergy=function(){return this.currentEnergy},t}(u)).prototype,"coinsLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(m.prototype,"energyProgressBar",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(m.prototype,"energyValueLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(m.prototype,"messagesLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=m))||d)),o._RF.pop()}}})),System.register("chunks:///_virtual/SpineController.ts.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var t,n,r,i,o,a,s,l,c,u,p,f,h,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.sp,l=e.Prefab,c=e.UITransform,u=e.Node,p=e.Vec3,f=e.instantiate,h=e.Component},function(e){g=e.SocketManager}],execute:function(){var b,d,m,y,L,v,k,w,P;o._RF.push({},"7af28zZEkNKYY1uSBPGocx/","SpineController.ts",void 0);var T=a.ccclass,x=a.property;e("SpineController",(b=T("SpineController"),d=x(s.Skeleton),m=x(g),y=x(l),b((k=t((v=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"spine",k,i(t)),r(t,"socketManager",w,i(t)),r(t,"floatingTextPrefab",P,i(t)),t}n(t,e);var o=t.prototype;return o.onLoad=function(){var e=this.getComponent(c);e||(e=this.addComponent(c)),e.setContentSize(4e3,3e3),e.setAnchorPoint(.553265,.004952),this.node.on(u.EventType.TOUCH_END,this.onSpineClicked,this),this.spine?(this.spine.setAnimation(0,"Основная",!0),this.spine.setCompleteListener(this.onAnimationComplete.bind(this))):console.warn("Spine компонент не установлен в SpineController.")},o.onSpineClicked=function(e){console.log("Spine animation clicked"),this.spine&&(this.spine.setAnimation(1,"Нажатие",!1),this.spine.addAnimation(1,"Основная",!0,0)),this.socketManager?(console.log("Calling socketManager.onTap()"),this.socketManager.onTap()):console.warn("SocketManager не установлен в SpineController.");var t=e.getUILocation();console.log("Tap Position (UILocation):",t),this.spawnFloatingText(t)},o.onAnimationComplete=function(e){e&&1===e.trackIndex&&this.spine.setAnimation(1,"Основная",!0)},o.spawnFloatingText=function(e){if(this.floatingTextPrefab){var t=this.node.scene.getChildByName("Canvas");if(t){var n=t.getComponent(c);if(n){var r=n.contentSize;console.log("Canvas Size:",r);var i=e.x-r.width/2,o=e.y-r.height/2,a=new p(i,o,100);console.log("Converted Local Position:",a);var s=f(this.floatingTextPrefab);s.setParent(t),s.setPosition(a),console.log("FloatingText Position Set To:",s.getPosition())}else console.warn("UITransform не найден на Canvas.")}else console.warn("Canvas не найден.")}else console.warn("floatingTextPrefab не установлен в SpineController.")},t}(h)).prototype,"spine",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(v.prototype,"socketManager",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(v.prototype,"floatingTextPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=v))||L)),o._RF.pop()}}})),System.register("chunks:///_virtual/TabBarController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,i,o,a,s,l,c,u,p,f,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.Node,l=e.Label,c=e.UIOpacity,u=e.tween,p=e.Vec3,f=e.Color,h=e.Component}],execute:function(){var g,b,d,m,y,L,v,k,w,P,T,x,C,I,z,F,S,M,U,N,_,D,R,E,B,H,A,V,j,G,O,Y,W,K,Z,q,J,Q,X,$,ee,te,ne;o._RF.push({},"40497KNIRZM96W3FB/cr0rR","TabBarController",void 0);var re=a.ccclass,ie=a.property;e("TabBarController",(g=re("TabBarController"),b=ie(s),d=ie(s),m=ie(s),y=ie(s),L=ie(s),v=ie(s),k=ie(s),w=ie(s),P=ie(s),T=ie(s),x=ie(l),C=ie(l),I=ie(l),z=ie(l),F=ie(l),S=ie(s),M=ie(s),U=ie(s),N=ie(s),_=ie(s),g((E=t((R=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,r(t,"mainPage",E,i(t)),r(t,"friendsPage",B,i(t)),r(t,"storePage",H,i(t)),r(t,"leadersPage",A,i(t)),r(t,"tasksPage",V,i(t)),r(t,"iconHome",j,i(t)),r(t,"iconFriends",G,i(t)),r(t,"iconStore",O,i(t)),r(t,"iconLeaders",Y,i(t)),r(t,"iconTasks",W,i(t)),r(t,"textHome",K,i(t)),r(t,"textFriends",Z,i(t)),r(t,"textStore",q,i(t)),r(t,"textLeaders",J,i(t)),r(t,"textTasks",Q,i(t)),r(t,"buttonHome",X,i(t)),r(t,"buttonFriends",$,i(t)),r(t,"buttonLeaders",ee,i(t)),r(t,"buttonTasks",te,i(t)),r(t,"activeButton",ne,i(t)),t.currentTab="home",t}n(t,e);var o=t.prototype;return o.onLoad=function(){var e=this;this.checkProperties(),this.showPage(this.currentTab,!1),this.iconHome.on(s.EventType.TOUCH_END,(function(){e.showPage("home",!0)})),this.iconFriends.on(s.EventType.TOUCH_END,(function(){e.showPage("friends",!0)})),this.iconStore.on(s.EventType.TOUCH_END,(function(){e.showPage("store",!0)})),this.iconLeaders.on(s.EventType.TOUCH_END,(function(){e.showPage("leaders",!0)})),this.iconTasks.on(s.EventType.TOUCH_END,(function(){e.showPage("tasks",!0)}))},o.checkProperties=function(){[{name:"mainPage",value:this.mainPage},{name:"friendsPage",value:this.friendsPage},{name:"storePage",value:this.storePage},{name:"leadersPage",value:this.leadersPage},{name:"tasksPage",value:this.tasksPage},{name:"iconHome",value:this.iconHome},{name:"iconFriends",value:this.iconFriends},{name:"iconStore",value:this.iconStore},{name:"iconLeaders",value:this.iconLeaders},{name:"iconTasks",value:this.iconTasks},{name:"textHome",value:this.textHome},{name:"textFriends",value:this.textFriends},{name:"textStore",value:this.textStore},{name:"textLeaders",value:this.textLeaders},{name:"textTasks",value:this.textTasks},{name:"buttonHome",value:this.buttonHome},{name:"buttonFriends",value:this.buttonFriends},{name:"buttonLeaders",value:this.buttonLeaders},{name:"buttonTasks",value:this.buttonTasks},{name:"activeButton",value:this.activeButton}].forEach((function(e){e.value||console.warn('Property "'+e.name+'" is not assigned in the inspector.')}))},o.showPage=function(e,t){void 0===t&&(t=!0),e!==this.currentTab&&(this.hidePage(this.currentTab,t),this.showNewPage(e,t),this.updateTabUI(e),this.currentTab=e)},o.hidePage=function(e,t){var n=this.getPageNode(e);if(n){var r=n.getComponent(c);r||(console.warn('UIOpacity component not found on "'+e+'" page. Adding one.'),r=n.addComponent(c)),t?(u(n).to(.3,{scale:new p(.95,.95,1)}).start(),u(r).to(.3,{opacity:0}).call((function(){n.active=!1,n.setScale(1,1,1),r.opacity=255,console.log('Page "'+e+'" скрыта.')})).start()):(n.active=!1,r.opacity=255,console.log('Page "'+e+'" скрыта без анимации.'))}else console.error('Page node for "'+e+'" not found.')},o.showNewPage=function(e,t){var n=this.getPageNode(e);if(n){n.active=!0;var r=n.getComponent(c);r||(console.warn('UIOpacity component not found on "'+e+'" page. Adding one.'),r=n.addComponent(c)),t?(r.opacity=0,n.setScale(.95,.95,1),u(r).to(.3,{opacity:255}).start(),u(n).to(.3,{scale:new p(1.05,1.05,1)}).to(.3,{scale:new p(1,1,1)}).call((function(){console.log('Page "'+e+'" показана.')})).start()):(r.opacity=255,n.setScale(1,1,1),console.log('Page "'+e+'" показана без анимации.'))}else console.error('Page node for "'+e+'" not found.')},o.getPageNode=function(e){switch(e){case"home":return this.mainPage;case"friends":return this.friendsPage;case"store":return this.storePage;case"leaders":return this.leadersPage;case"tasks":return this.tasksPage;default:return console.warn("Unknown page: "+e),null}},o.updateTabUI=function(e){switch(this.textHome.color=f.GRAY,this.textFriends.color=f.GRAY,this.textStore.color=f.GRAY,this.textLeaders.color=f.GRAY,this.textTasks.color=f.GRAY,this.activeButton.active=!1,this.buttonHome.active=!1,this.buttonFriends.active=!1,this.buttonLeaders.active=!1,this.buttonTasks.active=!1,e){case"home":this.textHome.color=f.WHITE,this.buttonHome.active=!0;break;case"friends":this.textFriends.color=f.WHITE,this.buttonFriends.active=!0;break;case"store":this.textStore.color=f.WHITE,this.activeButton.active=!0;break;case"leaders":this.textLeaders.color=f.WHITE,this.buttonLeaders.active=!0;break;case"tasks":this.textTasks.color=f.WHITE,this.buttonTasks.active=!0}},t}(h)).prototype,"mainPage",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(R.prototype,"friendsPage",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(R.prototype,"storePage",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(R.prototype,"leadersPage",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(R.prototype,"tasksPage",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(R.prototype,"iconHome",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(R.prototype,"iconFriends",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(R.prototype,"iconStore",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(R.prototype,"iconLeaders",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(R.prototype,"iconTasks",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(R.prototype,"textHome",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(R.prototype,"textFriends",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(R.prototype,"textStore",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(R.prototype,"textLeaders",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(R.prototype,"textTasks",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(R.prototype,"buttonHome",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(R.prototype,"buttonFriends",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(R.prototype,"buttonLeaders",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(R.prototype,"buttonTasks",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(R.prototype,"activeButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=R))||D)),o._RF.pop()}}})),a="virtual:///prerequisite-imports/main",s="chunks:///_virtual/main",System.register(a,[s],(function(e,t){return{setters:[function(t){var n={};for(var r in t)"default"!==r&&"__esModule"!==r&&(n[r]=t[r]);e(n)}],execute:function(){}}})),e("default",r.exports)}),{})}}}));

System.register("chunks:///_virtual/LeadersPage.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var r,n,t,a,i,s,l,o,u,c,h,b,p,f;return{setters:[function(e){r=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){l=e.cclegacy,o=e._decorator,u=e.ScrollView,c=e.Prefab,h=e.Label,b=e.instantiate,p=e.Component},function(e){f=e.SocketManager}],execute:function(){var L,d,m,g,U,k,y,w,C,v,I,z,P,R;l._RF.push({},"509aaKVAOZOU4SArmn1DqkK","LeadersPage",void 0);var _=o.ccclass,x=o.property;e("LeaderBoardPage",(L=_("LeaderBoardPage"),d=x(u),m=x(c),g=x(h),U=x(h),k=x(h),L((C=r((w=function(e){function r(){for(var r,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return r=e.call.apply(e,[this].concat(i))||this,t(r,"scrollView",C,a(r)),t(r,"leaderItemPrefab",v,a(r)),t(r,"currentRankLabel",I,a(r)),t(r,"currentUsernameLabel",z,a(r)),t(r,"currentCoinsLabel",P,a(r)),t(r,"apiBaseUrl",R,a(r)),r}n(r,e);var l=r.prototype;return l.onEnable=function(){if(!f.instance)return console.error("SocketManager не инициализирован."),void this.displayError("Ошибка инициализации.");f.instance.getUserId()?this.fetchLeaders():f.instance.on("userInitialized",this.onUserInitialized,this)},l.onDisable=function(){f.instance&&f.instance.off("userInitialized",this.onUserInitialized,this)},l.onUserInitialized=function(){this.fetchLeaders()},l.fetchLeaders=function(){var e=i(s().mark((function e(){var r,n,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.instance.getUserId()){e.next=5;break}return console.error("userId не установлен в SocketManager."),this.displayError("Неизвестный пользователь."),e.abrupt("return");case 5:return e.prev=5,e.next=8,fetch(this.apiBaseUrl+"?userId="+r);case 8:if((n=e.sent).ok){e.next=16;break}if(404!==n.status){e.next=15;break}return console.warn("Топ-лидеров пока нет."),this.populateLeadersList([]),this.displayCurrentUser(null),e.abrupt("return");case 15:throw new Error("Network response was not ok");case 16:return e.next=18,n.json();case 18:t=e.sent,this.populateLeadersList(t.top50),t.currentUser?this.displayCurrentUser(t.currentUser):this.displayCurrentUser(null),this.scrollView&&this.scrollView.scrollToTop(0,!1),e.next=30;break;case 24:e.prev=24,e.t0=e.catch(5),console.error("Ошибка при загрузке списка лидеров:",e.t0),this.displayError("Не удалось загрузить список лидеров."),this.populateLeadersList([]),this.displayCurrentUser(null);case 30:case"end":return e.stop()}}),e,this,[[5,24]])})));return function(){return e.apply(this,arguments)}}(),l.populateLeadersList=function(e){var r=this,n=this.scrollView.content;n.removeAllChildren(),e.forEach((function(e,t){var a=b(r.leaderItemPrefab);a.parent=n;var i=a.getComponentsInChildren(h),s=null,l=null,o=null;i.forEach((function(e){var r=e.node.name;"NumberLabel"===r?s=e:"UsernameLabel"===r?l=e:"CoinsLabel"===r&&(o=e)})),s&&l&&o?(s.string="#"+e.rank,e.username&&e.username.length>0?l.string=e.username:e.full_name&&e.full_name.length>0?l.string=e.full_name:l.string="Анонимный игрок",o.string=r.formatCoins(e.coins)):console.warn("Не удалось найти один из Label компонентов в LeaderItem")}))},l.displayCurrentUser=function(e){e?(this.currentRankLabel?this.currentRankLabel.string="#"+e.rank:console.warn("currentRankLabel не назначен в LeaderBoardPage."),this.currentUsernameLabel?e.username&&e.username.length>0?this.currentUsernameLabel.string=e.username:e.full_name&&e.full_name.length>0?this.currentUsernameLabel.string=e.full_name:this.currentUsernameLabel.string="Анонимный игрок":console.warn("currentUsernameLabel не назначен в LeaderBoardPage."),this.currentCoinsLabel?this.currentCoinsLabel.string=""+this.formatCoins(e.coins):console.warn("currentCoinsLabel не назначен в LeaderBoardPage.")):(this.currentRankLabel&&(this.currentRankLabel.string=""),this.currentUsernameLabel&&(this.currentUsernameLabel.string=""),this.currentCoinsLabel&&(this.currentCoinsLabel.string=""))},l.displayError=function(e){this.currentUsernameLabel&&(this.currentUsernameLabel.string=e),this.currentRankLabel&&(this.currentRankLabel.string=""),this.currentCoinsLabel&&(this.currentCoinsLabel.string="")},l.formatCoins=function(e){return e>=1e6?(e/1e6).toFixed(2)+"M":Math.round(e).toLocaleString("ru-RU")},r}(p)).prototype,"scrollView",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(w.prototype,"leaderItemPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=r(w.prototype,"currentRankLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=r(w.prototype,"currentUsernameLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=r(w.prototype,"currentCoinsLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=r(w.prototype,"apiBaseUrl",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/users/leaders"}}),y=w))||y));l._RF.pop()}}}));

System.register("chunks:///_virtual/LicenseModal.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var o,n,t,i,l,s,c,r;return{setters:[function(e){o=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,s=e._decorator,c=e.Node,r=e.Component}],execute:function(){var a,u,d,h,M,p,f;l._RF.push({},"574fddXu35GV6qNybxlYegp","LicenseModal",void 0);var y=s.ccclass,v=s.property;e("LicenseModal",(a=y("LicenseModal"),u=v(c),d=v(c),a((p=o((M=function(e){function o(){for(var o,n=arguments.length,l=new Array(n),s=0;s<n;s++)l[s]=arguments[s];return o=e.call.apply(e,[this].concat(l))||this,t(o,"licenseModal",p,i(o)),t(o,"closeButton",f,i(o)),o}n(o,e);var l=o.prototype;return l.onLoad=function(){this.licenseModal?this.licenseModal.active=!1:console.error("licenseModal не назначен в LicenseModal."),this.closeButton?this.closeButton.on(c.EventType.TOUCH_END,this.hideModal,this):console.warn("closeButton не назначен в LicenseModal.")},l.showModal=function(){this.licenseModal?this.licenseModal.active=!0:console.error("licenseModal не назначен в LicenseModal.")},l.hideModal=function(){this.licenseModal?this.licenseModal.active=!1:console.error("licenseModal не назначен в LicenseModal.")},l.onDestroy=function(){this.closeButton&&this.closeButton.off(c.EventType.TOUCH_END,this.hideModal,this)},o}(r)).prototype,"licenseModal",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=o(M.prototype,"closeButton",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=M))||h));l._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,o,c,t,r;return{setters:[function(e){n=e.inheritsLoose},function(e){o=e.cclegacy,c=e._decorator,t=e.director,r=e.Component}],execute:function(){var i;o._RF.push({},"97f03u690dF5KopqdXd/SHJ","LoadingScreen",void 0);var a=c.ccclass;c.property,e("LoadingScreen",a("LoadingScreen")(i=function(e){function o(){return e.apply(this,arguments)||this}n(o,e);var c=o.prototype;return c.start=function(){this.loadGameScene()},c.loadGameScene=function(){t.preloadScene("MainScene",null,(function(){t.loadScene("MainScene")}))},o}(r))||i);o._RF.pop()}}}));

System.register("chunks:///_virtual/LockedModalCard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,o,a,n,t,i,c,l,u;return{setters:[function(e){r=e.applyDecoratedDescriptor,o=e.inheritsLoose,a=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){t=e.cclegacy,i=e._decorator,c=e.Label,l=e.Sprite,u=e.Component}],execute:function(){var s,d,b,p,f,y,L;t._RF.push({},"7e2a9899BlAeazduSbsIEds","LockedModalCard",void 0);var h=i.ccclass,k=i.property;e("LockedModalCard",(s=h("LockedModalCard"),d=k(c),b=k(l),s((y=r((f=function(e){function r(){for(var r,o=arguments.length,t=new Array(o),i=0;i<o;i++)t[i]=arguments[i];return r=e.call.apply(e,[this].concat(t))||this,a(r,"numberOfDayLabel",y,n(r)),a(r,"lockIcon",L,n(r)),r}o(r,e);var t=r.prototype;return t.setDayNumber=function(e){this.numberOfDayLabel?this.numberOfDayLabel.string="День "+e:console.warn("LockedModalCard: numberOfDayLabel не назначен.")},t.setCardData=function(e){this.setDayNumber(e.day),this.lockIcon?this.lockIcon.node.active=!0:console.warn("LockedModalCard: lockIcon не назначен.")},r}(u)).prototype,"numberOfDayLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=r(f.prototype,"lockIcon",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./SpineController.ts.ts","./index.mjs_cjs=&original=2.js","./index.mjs_cjs=&original=3.js","./BoostController.ts","./BoosterModal.ts","./BoosterScrollView.ts","./DailyCardsPage.ts","./DayCard.ts","./FloatingText.ts","./FriendsPage.ts","./IncomeManager.ts","./LeadersPage.ts","./LoadingScreen.ts","./MarketModal.ts","./MarketScrollView.ts","./MarketTabController.ts","./DailyCardsDetailsModal.ts","./DailyCardsModal.ts","./GameRulesModal.ts","./LicenseModal.ts","./ProfileModal.ts","./PassiveIncomeModal.ts","./LockedModalCard.ts","./OpenedModalCard.ts","./UnlockedModalCard.ts","./QuestItem.ts","./QuestsPage.ts","./ReferralLinkManager.ts","./SocketManager.ts","./TabBarController.ts","./Telegram.ts","./DailyCardUtils.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MarketModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MarketScrollView.ts"],(function(t){var e,i,n,r,o,a,s,l,u,c,p,h,m,b,d,f,k,S;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){s=t.cclegacy,l=t._decorator,u=t.Label,c=t.Node,p=t.Sprite,h=t.SpriteFrame,m=t.Animation,b=t.BlockInputEvents,d=t.UITransform,f=t.Button,k=t.Component},function(t){S=t.MarketScrollView}],execute:function(){var g,y,M,I,L,w,v,C,x,z,N,A,D,F,E,T,P,V,B,R,U,_,H,j,K,O,G;s._RF.push({},"0d5873T5+ZLn5A0pp0p3Xs8","MarketModal",void 0);var X=l.ccclass,Y=l.property;t("MarketModal",(g=X("MarketModal"),y=Y(u),M=Y(c),I=Y(p),L=Y(u),w=Y(u),v=Y(u),C=Y(c),x=Y(p),z=Y(h),N=Y(h),A=Y([h]),D=Y(S),g((T=e((E=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,n(e,"coinLabel",T,r(e)),n(e,"xMarkNode",P,r(e)),n(e,"imageSprite",V,r(e)),n(e,"marketCountLabel",B,r(e)),n(e,"titleLabel",R,r(e)),n(e,"descrLabel",U,r(e)),n(e,"buttonNode",_,r(e)),n(e,"buttonSprite",H,r(e)),n(e,"payButtonSprite",j,r(e)),n(e,"noEnoughSprite",K,r(e)),n(e,"marketItemSprites",O,r(e)),n(e,"marketScrollView",G,r(e)),e.marketItemSpritesDict={},e.currentItem=null,e.userCoins=1e6,e.animation=null,e.isAnimating=!1,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.initializeMarketItemSpritesDict(),this.animation=this.getComponent(m),this.animation||console.warn("Компонент Animation не найден на узле MarketModal. Пожалуйста, добавьте его в редакторе.");this.getComponent(b)||this.addComponent(b);if(this.xMarkNode){var t=this.xMarkNode.getComponent(d);t?t.setContentSize(100,100):console.warn("Компонент UITransform не найден на узле xMarkNode."),(this.xMarkNode.getComponent(f)||this.xMarkNode.addComponent(f)).node.on(f.EventType.CLICK,this.hide,this)}this.buttonNode&&(this.buttonNode.getComponent(f)||this.buttonNode.addComponent(f)).node.on(f.EventType.CLICK,this.onPurchase,this);this.animation&&(this.animation.on(m.EventType.PLAY,this.onAnimationPlay,this),this.animation.on(m.EventType.FINISHED,this.onAnimationFinished,this)),this.node.active=!1},s.initializeMarketItemSpritesDict=function(){var t=this;this.marketItemSprites.forEach((function(e){t.marketItemSpritesDict[e.name]=e}))},s.onAnimationPlay=function(){this.isAnimating=!0},s.onAnimationFinished=function(){this.isAnimating=!1,this.node.activeInHierarchy||(this.node.active=!1)},s.show=function(t){if(!this.isAnimating){this.currentItem=t,this.coinLabel.string=this.userCoins.toLocaleString("ru-RU");var e=this.marketItemSpritesDict[t.id.toString()];if(e)this.imageSprite?this.imageSprite.spriteFrame=e:console.error("imageSprite не назначен в MarketModal.");else{console.warn("SpriteFrame не найден для ID: "+t.id);var i=this.marketItemSpritesDict.default;i&&(this.imageSprite.spriteFrame=i)}this.titleLabel&&(this.titleLabel.string=t.title),this.descrLabel&&(this.descrLabel.string=t.description||""),this.marketCountLabel&&(this.marketCountLabel.string="Осталось "+t.count+" шт."),this.coinLabel&&(this.coinLabel.string=t.price.toLocaleString("ru-RU")),this.buttonNode&&(this.userCoins>=t.price&&t.count>0?this.buttonSprite?this.buttonSprite.spriteFrame=this.payButtonSprite:console.error("buttonSprite не назначен в MarketModal."):this.buttonSprite?this.buttonSprite.spriteFrame=this.noEnoughSprite:console.error("buttonSprite не назначен в MarketModal.")),this.node.active=!0,this.animation&&this.animation.clips.length>0&&this.animation.play("SlideIn")}},s.hide=function(){this.isAnimating||(this.animation&&this.animation.clips.length>0?this.animation.play("SlideOut"):this.node.active=!1)},s.onPurchase=function(){var t=o(a().mark((function t(){var e,i,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.currentItem){t.next=2;break}return t.abrupt("return");case 2:if(!(this.userCoins>=this.currentItem.price&&this.currentItem.count>0)){t.next=33;break}return 759417013,e=this.currentItem.id,i="https://misapat.ru/api/market-items/purchase?userId=759417013&itemId="+e,t.prev=6,t.next=9,fetch(i,{method:"POST"});case 9:return n=t.sent,t.next=12,n.json();case 12:if(r=t.sent,!n.ok){t.next=25;break}if(this.userCoins-=this.currentItem.price,this.coinLabel.string=this.userCoins.toLocaleString("ru-RU"),this.hide(),!this.marketScrollView){t.next=22;break}return t.next=20,this.marketScrollView.fetchMarketItems();case 20:t.next=23;break;case 22:console.warn("marketScrollView не назначен в MarketModal.");case 23:t.next=26;break;case 25:console.error("Ошибка при покупке товара:",r);case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(6),console.error("Ошибка сети при покупке товара:",t.t0);case 31:t.next=33;break;case 33:case"end":return t.stop()}}),t,this,[[6,28]])})));return function(){return t.apply(this,arguments)}}(),e}(k)).prototype,"coinLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(E.prototype,"xMarkNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(E.prototype,"imageSprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(E.prototype,"marketCountLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(E.prototype,"titleLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(E.prototype,"descrLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(E.prototype,"buttonNode",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(E.prototype,"buttonSprite",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(E.prototype,"payButtonSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(E.prototype,"noEnoughSprite",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(E.prototype,"marketItemSprites",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),G=e(E.prototype,"marketScrollView",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=E))||F));s._RF.pop()}}}));

System.register("chunks:///_virtual/MarketScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MarketModal.ts"],(function(e){var r,t,n,a,i,o,c,s,l,u,p,d,f,h,b,m,w,C,g;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime,c=e.createForOfIteratorHelperLoose},function(e){s=e.cclegacy,l=e._decorator,u=e.Prefab,p=e.Node,d=e.SpriteFrame,f=e.Component,h=e.Layout,b=e.instantiate,m=e.Sprite,w=e.Label,C=e.resources},function(e){g=e.MarketModal}],execute:function(){var k,D,y,v,P,S,I,B,x,M,L,z,T,N,F,R,A;s._RF.push({},"cc0125FA1xF2qe5sm5mSkIX","MarketScrollView",void 0);var H=l.ccclass,V=l.property;e("MarketScrollView",(k=H("MarketScrollView"),D=V(u),y=V(u),v=V(u),P=V(p),S=V([d]),I=V([d]),B=V(g),k((L=r((M=function(e){function r(){for(var r,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return r=e.call.apply(e,[this].concat(i))||this,n(r,"bannerPrefab",L,a(r)),n(r,"cardPrefab",z,a(r)),n(r,"cardRowPrefab",T,a(r)),n(r,"scrollContent",N,a(r)),n(r,"cardSprites",F,a(r)),n(r,"bannerSprites",R,a(r)),n(r,"marketModal",A,a(r)),r.cardSpritesDict={},r.bannerSpritesDict={},r}t(r,e);var s=r.prototype;return s.onLoad=function(){this.initializeCardSpritesDict(),this.initializeBannerSpritesDict(),this.fetchMarketItems(),this.logAvailableCards(),this.logAvailableBanners()},s.initializeCardSpritesDict=function(){var e=this;this.cardSprites.forEach((function(r){e.cardSpritesDict[r.name]=r}))},s.initializeBannerSpritesDict=function(){var e=this;this.bannerSprites.forEach((function(r){e.bannerSpritesDict[r.name]=r}))},s.fetchMarketItems=function(){var e=i(o().mark((function e(){var r,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://misapat.ru/api/market-items");case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("HTTP error! статус: "+r.status);case 6:return e.next=8,r.json();case 8:t=e.sent,this.populateScrollView(t),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Не удалось получить элементы рынка:",e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),s.populateScrollView=function(){var e=i(o().mark((function e(r){var t,n,a,i,s,l,u,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.scrollContent.removeAllChildren(),n=null,a=0,i=c(r);case 4:if((s=i()).done){e.next=30;break}if("banner"!==(l=s.value).type){e.next=15;break}return n&&a>0&&(this.scrollContent.addChild(n),n=null,a=0),u=b(this.bannerPrefab),e.next=11,this.setupBanner(u,l);case 11:this.scrollContent.addChild(u),this.addItemClickHandler(u,l),e.next=28;break;case 15:if("cardWithImage"!==l.type){e.next=28;break}if(n){e.next=21;break}if(this.cardRowPrefab){e.next=20;break}return console.error("Префаб CardRow не назначен."),e.abrupt("continue",28);case 20:n=b(this.cardRowPrefab);case 21:return p=b(this.cardPrefab),e.next=24,this.setupCard(p,l);case 24:n.addChild(p),a++,this.addItemClickHandler(p,l),a>=2&&(this.scrollContent.addChild(n),n=null,a=0);case 28:e.next=4;break;case 30:n&&a>0&&this.scrollContent.addChild(n),null==(t=this.scrollContent.getComponent(h))||t.updateLayout();case 32:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),s.setupBanner=function(){var e=i(o().mark((function e(r,t){var n,a,i,c,s,l,u,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=r.getChildByName("Image"))?(i=a.getComponent(m),c=this.bannerSpritesDict[""+t.id],i&&c?i.spriteFrame=c:(console.warn("Не удалось установить спрайт баннера из словаря для ID: "+t.id),console.warn("Доступные ключи в bannerSpritesDict: "+Object.keys(this.bannerSpritesDict).join(", ")),(s=this.bannerSpritesDict.default)&&(i.spriteFrame=s))):console.warn("Не найден узел Image в Banner Prefab для ID: "+t.id),(l=r.getChildByName("Title"))?(u=l.getComponent(w))?u.string=t.title:console.warn("Компонент Label не найден на узле Title в Banner Prefab для ID: "+t.id):console.warn("Не найден узел Title в Banner Prefab для ID: "+t.id),(p=null==(n=r.getChildByName("coin"))?void 0:n.getChildByName("Price"))?(d=p.getComponent(w))?d.string=this.formatPriceBanner(t.price):console.warn("Компонент Label не найден на узле Price в Banner Prefab для ID: "+t.id):console.warn("Не найден узел Price в Banner Prefab для ID: "+t.id);case 6:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}(),s.setupCard=function(){var e=i(o().mark((function e(r,t){var n,a,i,c,s,l,u,p,d,f,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=r.getChildByName("Image"))?(i=a.getComponent(m),c=this.cardSpritesDict[""+t.id],i&&c?i.spriteFrame=c:(console.warn("Не удалось установить спрайт карточки из словаря для ID: "+t.id),console.warn("Доступные ключи в cardSpritesDict: "+Object.keys(this.cardSpritesDict).join(", ")),(s=this.cardSpritesDict.default)&&(i.spriteFrame=s))):console.warn("Не найден узел Image в Card Prefab для ID: "+t.id),(l=r.getChildByName("Title"))?(u=l.getComponent(w))?u.string=t.title:console.warn("Компонент Label не найден на узле Title в Card Prefab для ID: "+t.id):console.warn("Не найден узел Title в Card Prefab для ID: "+t.id),(p=r.getChildByName("Descr"))&&t.description?(d=p.getComponent(w))?d.string=t.description:console.warn("Компонент Label не найден на узле Descr в Card Prefab для ID: "+t.id):t.description?console.warn("Не найден узел Descr в Card Prefab для ID: "+t.id):console.warn("Описание не предоставлено для карточки ID: "+t.id),(f=null==(n=r.getChildByName("coin"))?void 0:n.getChildByName("Price"))?(h=f.getComponent(w))?h.string=this.formatPriceCard(t.price):console.warn("Компонент Label не найден на узле Price в Card Prefab для ID: "+t.id):console.warn("Не найден узел Price в Card Prefab для ID: "+t.id);case 8:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}(),s.addItemClickHandler=function(e,r){var t=this;e.on(p.EventType.TOUCH_END,(function(){t.openModal(r)}),this)},s.openModal=function(e){this.marketModal?this.marketModal.show(e):console.warn("marketModal не назначен в MarketScrollView.")},s.formatPriceBanner=function(e){return e.toLocaleString("ru-RU")},s.formatPriceCard=function(e){return e>=1e6?e/1e6+"M":e.toLocaleString("ru-RU")},s.logAvailableCards=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.loadDir("images/backgrounds/market/cards",d,(function(e,r){e&&console.error("Ошибка загрузки директории карточек:",e)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s.logAvailableBanners=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.loadDir("images/backgrounds/market/banners",d,(function(e,r){e&&console.error("Ошибка загрузки директории баннеров:",e)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r}(f)).prototype,"bannerPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=r(M.prototype,"cardPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=r(M.prototype,"cardRowPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=r(M.prototype,"scrollContent",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=r(M.prototype,"cardSprites",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R=r(M.prototype,"bannerSprites",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=r(M.prototype,"marketModal",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=M))||x));s._RF.pop()}}}));

System.register("chunks:///_virtual/MarketTabController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,a,i,n,o,l,u,b,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,a=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){n=t.cclegacy,o=t._decorator,l=t.Node,u=t.Label,b=t.Color,s=t.Component}],execute:function(){var c,T,h,p,y,v,f,g,C,k,B,m,d,z,M;n._RF.push({},"4925f4FqhFPiZXmQ22WFh5o","MarketTabController",void 0);var w=o.ccclass,L=o.property;t("MarketTabController",(c=w("MarketTabController"),T=L(l),h=L(l),p=L(l),y=L(l),v=L(l),f=L(l),c((k=e((C=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,a(e,"marketTabBar",k,i(e)),a(e,"zagolovok",B,i(e)),a(e,"tovariTab",m,i(e)),a(e,"busteryTab",d,i(e)),a(e,"tovariContent",z,i(e)),a(e,"busteryContent",M,i(e)),e}r(e,t);var n=e.prototype;return n.start=function(){this.busteryTab.on(l.EventType.TOUCH_END,this.onBusteryTabClicked,this),this.tovariTab.on(l.EventType.TOUCH_END,this.onTovariTabClicked,this)},n.onBusteryTabClicked=function(t){this.toggleMarketTabBarButton(this.busteryTab,!0),this.toggleMarketTabBarButton(this.tovariTab,!1),this.setLabelOpacity(this.busteryTab,255),this.setLabelOpacity(this.tovariTab,140),this.busteryContent.active=!0,this.tovariContent.active=!1},n.onTovariTabClicked=function(t){this.toggleMarketTabBarButton(this.busteryTab,!1),this.toggleMarketTabBarButton(this.tovariTab,!0),this.setLabelOpacity(this.busteryTab,140),this.setLabelOpacity(this.tovariTab,255),this.busteryContent.active=!1,this.tovariContent.active=!0},n.toggleMarketTabBarButton=function(t,e){var r=t.getChildByName("marketTabBarButton");r&&(r.active=e)},n.setLabelOpacity=function(t,e){var r=t.getComponent(u);r&&(r.color=new b(255,255,255,e))},e}(s)).prototype,"marketTabBar",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(C.prototype,"zagolovok",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(C.prototype,"tovariTab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=e(C.prototype,"busteryTab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(C.prototype,"tovariContent",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(C.prototype,"busteryContent",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));n._RF.pop()}}}));

System.register("chunks:///_virtual/OpenedModalCard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n,t,i,a,o,l,u,c,d,p,s;return{setters:[function(e){r=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Label,u=e.Sprite,c=e.Button,d=e.resources,p=e.SpriteFrame,s=e.Component}],execute:function(){var f,b,y,h,m,C,v,O,S;a._RF.push({},"692192GTkdAGax+Q5kvh7vZ","OpenedModalCard",void 0);var D=o.ccclass,g=o.property;e("OpenedModalCard",(f=D("OpenedModalCard"),b=g(l),y=g(u),h=g(c),f((v=r((C=function(e){function r(){for(var r,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=e.call.apply(e,[this].concat(a))||this,t(r,"numberOfDayLabel",v,i(r)),t(r,"iconSprite",O,i(r)),t(r,"openCardButton",S,i(r)),r}n(r,e);var a=r.prototype;return a.setDayNumber=function(e,r){void 0===r&&(r="День "),this.numberOfDayLabel?this.numberOfDayLabel.string=""+r+e:console.warn("OpenedModalCard: numberOfDayLabel не назначен.")},a.setCardData=function(e){var r,n;(this.numberOfDayLabel&&this.setDayNumber(e.day),this.iconSprite&&null!=(r=e.card)&&r.image_url)?this.loadSpriteFrame(e.card.image_url):(this.iconSprite||console.warn("OpenedModalCard: iconSprite не назначен."),null!=(n=e.card)&&n.image_url||console.warn("OpenedModalCard: image_url отсутствует для дня "+e.day),this.iconSprite.node.active=!1)},a.loadSpriteFrame=function(e){var r=this;d.load(e,p,(function(n,t){if(n)return console.error("OpenedModalCard: Ошибка при загрузке иконки для пути: "+e,n),void(r.iconSprite.node.active=!1);r.iconSprite.spriteFrame=t,r.iconSprite.node.active=!0}))},a.onDestroy=function(){this.openCardButton&&this.openCardButton.node.off(c.EventType.CLICK,this.onViewCardClicked,this)},r}(s)).prototype,"numberOfDayLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=r(C.prototype,"iconSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=r(C.prototype,"openCardButton",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=C))||m));a._RF.pop()}}}));

System.register("chunks:///_virtual/PassiveIncomeModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var n,t,o,r,s,a,i,c,l,u,d,p;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized,s=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){i=e.cclegacy,c=e._decorator,l=e.Label,u=e.Node,d=e.Component},function(e){p=e.SocketManager}],execute:function(){var h,m,f,v,b,g,N,I,y;i._RF.push({},"dacc2yNsjdBz4TFNY64wdg5","PassiveIncomeModal",void 0);var w=c.ccclass,k=c.property;e("PassiveIncomeModal",(h=w("PassiveIncomeModal"),m=k(l),f=k(u),v=k(u),h((N=n((g=function(e){function n(){for(var n,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return n=e.call.apply(e,[this].concat(s))||this,o(n,"incomeLabel",N,r(n)),o(n,"modalNode",I,r(n)),o(n,"closeNode",y,r(n)),n.userId=null,n}t(n,e);var i=n.prototype;return i.start=function(){this.userId=p.instance.getUserId(),this.modalNode&&(this.modalNode.active=!1),this.closeNode?this.closeNode.on(u.EventType.TOUCH_END,this.onCloseClicked,this):console.warn("closeNode не назначен в PassiveIncomeModal.")},i.show=function(){var e=s(a().mark((function e(){var n,t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.incomeLabel||!this.modalNode){e.next=7;break}return e.next=3,this.fetchPassiveIncome();case 3:(n=e.sent)>0?(t=Math.round(n),console.log("PassiveIncomeModal.show получил income: "+n+", округлено до: "+t),this.incomeLabel.string="+ "+t,this.modalNode.active=!0):console.log("Пассивный доход равен нулю, модальное окно не будет показано."),e.next=8;break;case 7:console.error("incomeLabel или modalNode не назначены в PassiveIncomeModal.");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.fetchPassiveIncome=function(){var e=s(a().mark((function e(){var n,t,o,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://misapat.ru/api/passiveIncome?userId="+this.userId);case 3:if((n=e.sent).ok){e.next=9;break}return e.next=7,n.text();case 7:throw t=e.sent,new Error("HTTP error! status: "+n.status+", response: "+t);case 9:return e.next=11,n.json();case 11:if(o=e.sent,console.log("Passive income API response:",o),!("passive_income_earned"in o)){e.next=19;break}return r=Math.round(o.passive_income_earned),console.log("Пассивный доход получен: "+r),e.abrupt("return",r);case 19:if(!("message"in o)){e.next=24;break}return console.log("Сообщение от сервера: "+o.message),e.abrupt("return",0);case 24:return console.warn("Неизвестный формат ответа от сервера:",o),e.abrupt("return",0);case 26:e.next=32;break;case 28:return e.prev=28,e.t0=e.catch(0),console.error("Ошибка при получении пассивного дохода:",e.t0),e.abrupt("return",0);case 32:case"end":return e.stop()}}),e,this,[[0,28]])})));return function(){return e.apply(this,arguments)}}(),i.hide=function(){this.modalNode&&(this.modalNode.active=!1)},i.onCloseClicked=function(e){this.hide()},n}(d)).prototype,"incomeLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(g.prototype,"modalNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=n(g.prototype,"closeNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=g))||b));i._RF.pop()}}}));

System.register("chunks:///_virtual/ProfileModal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts","./LicenseModal.ts","./GameRulesModal.ts"],(function(e){var t,o,n,i,l,a,r,s,u,c,f,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,a=e._decorator,r=e.Node,s=e.Label,u=e.Component},function(e){c=e.SocketManager},function(e){f=e.LicenseModal},function(e){d=e.GameRulesModal}],execute:function(){var h,p,M,b,m,g,w,v,y,L,P,B,D,C,T,E,z,I,_,U,H,N,R;l._RF.push({},"bc556ZFRnpMnYIvGUp1KHAx","ProfileModal",void 0);var O=a.ccclass,S=a.property;e("ProfileModal",(h=O("ProfileModal"),p=S(r),M=S(r),b=S(r),m=S(s),g=S(s),w=S(s),v=S(r),y=S(f),L=S(r),P=S(d),h((C=t((D=function(e){function t(){for(var t,o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,n(t,"avatarIcon",C,i(t)),n(t,"profileModal",T,i(t)),n(t,"closeButton",E,i(t)),n(t,"idLabel",z,i(t)),n(t,"usernameLabel",I,i(t)),n(t,"registrationDateLabel",_,i(t)),n(t,"licenseButton",U,i(t)),n(t,"licenseModalComponent",H,i(t)),n(t,"rulesButton",N,i(t)),n(t,"rulesModalComponent",R,i(t)),t}o(t,e);var l=t.prototype;return l.onLoad=function(){this.profileModal?this.profileModal.active=!1:console.error("profileModal не назначен в ProfileModal."),this.avatarIcon?this.avatarIcon.on(r.EventType.TOUCH_END,this.showModal,this):console.warn("avatarIcon не назначен в ProfileModal."),this.closeButton?this.closeButton.on(r.EventType.TOUCH_END,this.hideModal,this):console.warn("closeButton не назначен в ProfileModal."),this.licenseButton?this.licenseButton.on(r.EventType.TOUCH_END,this.showLicenseModal,this):console.warn("licenseButton не назначен в ProfileModal."),this.rulesButton?this.rulesButton.on(r.EventType.TOUCH_END,this.showGameRulesModal,this):console.warn("rulesButton не назначен в ProfileModal."),c.instance.on("userInitialized",this.updateProfile,this),c.instance.isInitialized()&&this.updateProfile()},l.updateProfile=function(){if(c.instance){var e=c.instance.getUserId(),t=c.instance.getUsername(),o=c.instance.getRegistrationDate();if(this.idLabel?this.idLabel.string=""+e:console.warn("idLabel не назначен в ProfileModal."),this.usernameLabel?this.usernameLabel.string=""+t:console.warn("usernameLabel не назначен в ProfileModal."),this.registrationDateLabel){var n=this.formatDate(o);this.registrationDateLabel.string="Дата регистрации в приложении: "+n}else console.warn("registrationDateLabel не назначен в ProfileModal.")}else console.error("SocketManager не инициализирован.")},l.formatDate=function(e){if(!e)return"";var t=new Date(e);return String(t.getDate()).padStart(2,"0")+"."+String(t.getMonth()+1).padStart(2,"0")+"."+t.getFullYear()},l.showModal=function(){this.updateProfile(),this.profileModal?this.profileModal.active=!0:console.error("profileModal не назначен в ProfileModal.")},l.hideModal=function(){this.profileModal?this.profileModal.active=!1:console.error("profileModal не назначен в ProfileModal.")},l.showLicenseModal=function(){this.licenseModalComponent?this.licenseModalComponent.showModal():console.error("licenseModalComponent не назначен в ProfileModal.")},l.showGameRulesModal=function(){this.rulesModalComponent?this.rulesModalComponent.showModal():console.error("rulesModalComponent не назначен в ProfileModal.")},l.onDestroy=function(){this.avatarIcon&&this.avatarIcon.off(r.EventType.TOUCH_END,this.showModal,this),this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.hideModal,this),this.licenseButton&&this.licenseButton.off(r.EventType.TOUCH_END,this.showLicenseModal,this),this.rulesButton&&this.rulesButton.off(r.EventType.TOUCH_END,this.showGameRulesModal,this),c.instance.off("userInitialized",this.updateProfile,this)},t}(u)).prototype,"avatarIcon",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(D.prototype,"profileModal",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(D.prototype,"closeButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(D.prototype,"idLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(D.prototype,"usernameLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(D.prototype,"registrationDateLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(D.prototype,"licenseButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(D.prototype,"licenseModalComponent",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(D.prototype,"rulesButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(D.prototype,"rulesModalComponent",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=D))||B));l._RF.pop()}}}));

System.register("chunks:///_virtual/QuestItem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,a,i,n,l,s,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,s=e.Label,u=e.Component}],execute:function(){var o,c,b,p,L,d,f,h,w;n._RF.push({},"b27f9WqQnRO7biScKOuQLE5","QuestItem",void 0);var g=l.ccclass,m=l.property;e("QuestItem",(o=g("QuestItem"),c=m(s),b=m(s),p=m(s),o((f=t((d=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,a(t,"questLabel",f,i(t)),a(t,"rewardLabel",h,i(t)),a(t,"statusLabel",w,i(t)),t}return r(t,e),t.prototype.setData=function(e,t){var r,a;this.questLabel?this.questLabel.string=e.title:console.warn("questLabel не привязан."),this.rewardLabel?this.rewardLabel.string=t(e.reward):console.warn("rewardLabel не привязан."),this.statusLabel?this.statusLabel.string="completed"===e.status?"Выполнено":"Активно":console.warn("statusLabel не привязан."),console.log("QuestItem set: "+e.title+", Reward: "+(null==(r=this.rewardLabel)?void 0:r.string)+", Status: "+(null==(a=this.statusLabel)?void 0:a.string))},t}(u)).prototype,"questLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=t(d.prototype,"rewardLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(d.prototype,"statusLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=d))||L));n._RF.pop()}}}));

System.register("chunks:///_virtual/QuestsPage.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts","./QuestItem.ts"],(function(e){var t,r,n,o,s,a,c,i,u,l,p,f,h,b,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){c=e.cclegacy,i=e._decorator,u=e.ScrollView,l=e.Prefab,p=e.instantiate,f=e.Node,h=e.Component},function(e){b=e.SocketManager},function(e){g=e.QuestItem}],execute:function(){var m,k,w,d,v,I,y,Q,x;c._RF.push({},"c7417NES8lIs6Zfbmx72vVI","QuestsPage",void 0);var S=i.ccclass,P=i.property;e("QuestsPage",(m=S("QuestsPage"),k=P(u),w=P(l),d=P(String),m((y=t((I=function(e){function t(){for(var t,r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,n(t,"scrollView",y,o(t)),n(t,"questItemPrefab",Q,o(t)),n(t,"apiBaseUrl",x,o(t)),t}r(t,e);var c=t.prototype;return c.onEnable=function(){b.instance?b.instance.getUserId()?this.fetchQuests():console.error("userId не установлен в SocketManager."):console.error("SocketManager не инициализирован.")},c.fetchQuests=function(){var e=s(a().mark((function e(){var t,r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b.instance.getUserId()){e.next=4;break}return console.error("userId не установлен в SocketManager."),e.abrupt("return");case 4:return e.prev=4,e.next=7,fetch(this.apiBaseUrl+"?userId="+t);case 7:if((r=e.sent).ok){e.next=13;break}if(404!==r.status){e.next=12;break}return console.warn("Задания пока недоступны."),e.abrupt("return");case 12:throw new Error("Network response was not ok");case 13:return e.next=15,r.json();case 15:n=e.sent,console.log("Полученные данные:",n),this.populateQuestsList(n.tasks),this.scrollView&&this.scrollView.scrollToTop(0,!1),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),console.error("Ошибка при загрузке списка заданий:",e.t0);case 24:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(){return e.apply(this,arguments)}}(),c.populateQuestsList=function(e){var t=this;if(this.scrollView){var r=this.scrollView.content;r?(r.removeAllChildren(),e.forEach((function(e){console.log("Создание элемента для задания: "+e.title+", награда: "+e.reward);var n=p(t.questItemPrefab);n.parent=r;var o=n.getComponent(g);o?(o.setData(e,t.formatNumber.bind(t)),console.log("Данные задания установлены для: "+e.title)):console.warn("QuestItem компонент не найден на questItemPrefab."),n.on(f.EventType.TOUCH_END,(function(){t.onQuestClick(e)}))}))):console.error("scrollView.content не назначен.")}else console.error("scrollView не назначен.")},c.onQuestClick=function(e){"completed"!==e.status&&this.completeQuest(e.taskId)},c.completeQuest=function(){var e=s(a().mark((function e(t){var r,n,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.instance.getUserId()){e.next=4;break}return console.error("userId не установлен в SocketManager."),e.abrupt("return");case 4:return e.prev=4,e.next=7,fetch("https://misapat.ru/api/tasks/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r,taskId:t})});case 7:if((n=e.sent).ok){e.next=10;break}throw new Error("Не удалось выполнить задание.");case 10:return e.next=12,n.json();case 12:o=e.sent,console.log("Задание выполнено:",o),this.fetchQuests(),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),console.error("Ошибка при выполнении задания:",e.t0);case 20:case"end":return e.stop()}}),e,this,[[4,17]])})));return function(t){return e.apply(this,arguments)}}(),c.formatNumber=function(e){var t=e.toLocaleString("ru-RU");return console.log("Форматирование числа "+e+": "+t),t},t}(h)).prototype,"scrollView",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(I.prototype,"questItemPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(I.prototype,"apiBaseUrl",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://misapat.ru/api/tasks"}}),v=I))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/ReferralLinkManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var i,n,o,t,r,a,l,c,s,p,f,u,L,d,h;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,t=e.assertThisInitialized,r=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){l=e.cclegacy,c=e._decorator,s=e.Node,p=e.Label,f=e.Vec3,u=e.Component,L=e.Color,d=e.tween},function(e){h=e.SocketManager}],execute:function(){var b,k,y,g,v,N,m,w,C,R,D,T,F;l._RF.push({},"18bc3yUuD1GYI5rJViGJcp5","ReferralLinkManager",void 0);var I=c.ccclass,M=c.property;e("ReferralLinkManager",(b=I("ReferralLinkManager"),k=M(s),y=M(s),g=M(p),v=M(p),b((w=i((m=function(e){function i(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,o(i,"copyLinkNode",w,t(i)),o(i,"inviteFriendNode",C,t(i)),o(i,"referralLinkLabel",R,t(i)),o(i,"copyNotificationLabel",D,t(i)),i.referralLink="",o(i,"animationDuration",T,t(i)),o(i,"moveUpDistance",F,t(i)),i.initialPosition=new f,i}n(i,e);var l=i.prototype;return l.start=function(){this.copyLinkNode||console.error("copyLinkNode не назначен в ReferralLinkManager."),this.inviteFriendNode||console.error("inviteFriendNode не назначен в ReferralLinkManager."),this.referralLinkLabel||console.error("referralLinkLabel не назначен в ReferralLinkManager."),this.copyNotificationLabel||console.error("copyNotificationLabel не назначен в ReferralLinkManager."),this.generateReferralLink(),this.copyLinkNode&&(this.copyLinkNode.on(s.EventType.TOUCH_END,this.onCopyLinkClicked,this),this.copyLinkNode.active=!0),this.inviteFriendNode&&this.inviteFriendNode.on(s.EventType.TOUCH_END,this.onInviteFriendClicked,this),this.copyNotificationLabel&&(this.copyNotificationLabel.node.active=!1,this.initialPosition=this.copyNotificationLabel.node.position.clone())},l.generateReferralLink=function(){var e,i=(null==(e=h.instance)?void 0:e.getUserId())||230230230;console.log("User ID:",i),i?(this.referralLink="https://t.me/misapatthreezeroBot?startapp=refId"+i,this.referralLinkLabel&&(this.referralLinkLabel.string=this.referralLink),console.log("Реферальная ссылка создана: "+this.referralLink)):console.error("userId не установлен.")},l.onCopyLinkClicked=function(){var e=r(a().mark((function e(){var i=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onCopyLinkClicked called"),this.copyNotificationLabel&&(this.copyNotificationLabel.node.active=!0,this.copyNotificationLabel.color=new L(255,255,255,255),this.copyNotificationLabel.node.setPosition(this.initialPosition.clone()),d(this.copyNotificationLabel).to(this.animationDuration,{color:new L(255,255,255,0)}).start(),d(this.copyNotificationLabel.node).by(this.animationDuration,{position:new f(0,this.moveUpDistance,0)}).call((function(){i.copyNotificationLabel.node.active=!1,i.copyNotificationLabel.color=new L(255,255,255,255),i.copyNotificationLabel.node.setPosition(i.initialPosition.clone())})).start()),this.referralLink){e.next=5;break}return console.warn("Реферальная ссылка не создана."),e.abrupt("return");case 5:return e.prev=5,e.next=8,navigator.clipboard.writeText(this.referralLink);case 8:console.log("Реферальная ссылка скопирована в буфер обмена."),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),console.error("Не удалось скопировать ссылку: ",e.t0);case 14:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}(),l.onInviteFriendClicked=function(){var e;if(console.log("onInviteFriendClicked called"),this.referralLink){var i="https://t.me/share/url?url="+encodeURIComponent(this.referralLink)+"&text="+encodeURIComponent("Тапай и зарабатывай!"),n=null==(e=window.Telegram)?void 0:e.WebApp;n&&n.openTelegramLink?(console.log("Используем tg.openTelegramLink для открытия ссылки"),n.openTelegramLink(i)):(console.warn("Не удалось открыть Telegram для совместного использования."),window.open(i,"_blank"))}else console.warn("Реферальная ссылка не создана.")},i}(u)).prototype,"copyLinkNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(m.prototype,"inviteFriendNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=i(m.prototype,"referralLinkLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(m.prototype,"copyNotificationLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=i(m.prototype,"animationDuration",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),F=i(m.prototype,"moveUpDistance",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),N=m))||N));l._RF.pop()}}}));

System.register("chunks:///_virtual/SocketManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./IncomeManager.ts","./PassiveIncomeModal.ts"],(function(e){var t,n,r,s,a,o,i,c,u,l,h,p,d,f,g,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,s=e.assertThisInitialized,a=e.createClass,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){c=e.cclegacy,u=e._decorator,l=e.Label,h=e.ProgressBar,p=e.EventTarget,d=e.Color,f=e.Component},function(e){g=e.IncomeManager},function(e){m=e.PassiveIncomeModal}],execute:function(){var b,v,w,k,y,x,_,I,M,L,U,P,T,E,D,C,S,A,B,H;c._RF.push({},"a0c39VZ6j5NRrT6cxMHqDGB","SocketManager",void 0);var z=u.ccclass,j=u.property;e("SocketManager",(b=z("SocketManager"),v=j(l),w=j(h),k=j(l),y=j(l),x=j(l),_=j(g),I=j(m),M=j(l),b(((H=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,r(t,"coinsLabel",P,s(t)),r(t,"energyProgressBar",T,s(t)),r(t,"energyValueLabel",E,s(t)),r(t,"messagesLabel",D,s(t)),r(t,"boostsLabel",C,s(t)),r(t,"incomeManager",S,s(t)),r(t,"passiveIncomeModal",A,s(t)),r(t,"passiveIncomePerHourLabel",B,s(t)),t.socket=null,t.userId=null,t.username="",t.userData=null,t.maxEnergy=2e3,t.currentEnergy=0,t.currentBoosts=0,t.maxBoosts=6,t.currentCoins=0,t.eventTarget=new p,t.registrationDate="",t.initialized=!1,t}n(t,e);var c=t.prototype;return c.on=function(e,t,n){this.eventTarget.on(e,t,n)},c.off=function(e,t,n){this.eventTarget.off(e,t,n)},c.onLoad=function(){if(t._instance&&t._instance!==this)return console.warn("SocketManager уже существует. Удаление дубликата."),void this.node.destroy();t._instance=this},c.start=function(){var e=o(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.coinsLabel&&this.energyProgressBar&&this.energyValueLabel&&this.messagesLabel&&this.boostsLabel&&this.passiveIncomePerHourLabel){e.next=3;break}return console.error("Не все необходимые компоненты назначены в SocketManager."),e.abrupt("return");case 3:return this.incomeManager||((t=this.node.scene.getChildByName("IncomeManagerNode"))?this.incomeManager=t.getComponent(g):console.warn("IncomeManager не найден в сцене.")),e.next=6,this.initializeUser();case 6:this.showUserInfo(!1);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.onDestroy=function(){this.socket&&this.socket.disconnect(),t._instance===this&&(t._instance=null)},c.loadTelegramSDK=function(){return new Promise((function(e,t){if(window.Telegram)e();else{var n=document.createElement("script");n.src="https://telegram.org/js/telegram-web-app.js",n.onload=function(){e()},n.onerror=function(){t(new Error("Не удалось загрузить Telegram Web Apps SDK."))},document.head.appendChild(n)}}))},c.initializeUser=function(){var e=o(i().mark((function e(){var t,n,r,s,a,o,c,u,l,h,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadTelegramSDK();case 3:if(!(n=null==(t=window.Telegram)?void 0:t.WebApp)){e.next=36;break}if(n.ready&&n.ready.isAvailable&&n.ready.isAvailable()?(n.ready(),console.log("Telegram Mini App: ready() вызван.")):console.warn("Метод ready() недоступен."),s=window.location.hostname,a="localhost"===s||"127.0.0.1"===s||"::1"===s,console.log("Current Hostname: "+s),console.log("Is Localhost: "+a),o=n.platform,console.log("Telegram Mini App Platform: "+o),a||"android"===o||"ios"===o){e.next=16;break}return alert("Это приложение доступно только на мобильных устройствах."),n.close&&n.close.isAvailable&&n.close.isAvailable()?(n.close(),console.log("Telegram Mini App: close() вызван.")):console.error("Метод close() недоступен."),e.abrupt("return");case 16:if(null==n.expand||n.expand(),null==n.disableVerticalSwipes||n.disableVerticalSwipes(),n.isVerticalSwipesEnabled=!1,null==n.setBackgroundColor||n.setBackgroundColor("#272727"),null!=n&&n.web_app_setup_swipe_behavior&&n.web_app_setup_swipe_behavior({allow_vertical_swipe:!1}),null==(r=n.initDataUnsafe)||null==(r=r.user)||!r.id){e.next=30;break}return c={id:n.initDataUnsafe.user.id,username:n.initDataUnsafe.user.username,first_name:n.initDataUnsafe.user.first_name,last_name:n.initDataUnsafe.user.last_name||"",language_code:n.initDataUnsafe.user.language_code||"",is_premium:n.initDataUnsafe.user.is_premium||!1,photo_url:n.initDataUnsafe.user.photo_url||"",full_name:n.initDataUnsafe.user.first_name+" "+(n.initDataUnsafe.user.last_name||"")},this.userId=c.id,this.username=c.username,this.userData=c,e.next=28,this.startApp(n);case 28:e.next=34;break;case 30:return console.warn("Данные пользователя не найдены в tg.initDataUnsafe."),this.useMockData(),e.next=34,this.startApp(n);case 34:e.next=40;break;case 36:return console.warn("Telegram WebApp недоступен. Используем моковые данные."),this.useMockData(),e.next=40,this.startApp(n);case 40:if(u=window.location.hostname,l="localhost"===u||"127.0.0.1"===u||"::1"===u,!n||"android"!==n.platform&&"ios"!==n.platform&&!l){e.next=51;break}return e.next=45,this.createOrUpdateUser(this.userData);case 45:return e.next=47,this.fetchInitialData();case 47:this.autoConnect(),this.showUserInfo(!0),this.initialized=!0,this.eventTarget.emit("userInitialized");case 51:e.next=59;break;case 53:e.prev=53,e.t0=e.catch(0),console.error("Ошибка при инициализации пользователя:",e.t0),alert("Произошла ошибка при запуске приложения."),(p=null==(h=window.Telegram)?void 0:h.WebApp)&&p.close&&p.close.isAvailable&&p.close.isAvailable()&&(p.close(),console.log("Telegram Mini App: close() вызван из catch."));case 59:case"end":return e.stop()}}),e,this,[[0,53]])})));return function(){return e.apply(this,arguments)}}(),c.startApp=function(){var e=o(i().mark((function e(t){var n,r,s,a,o,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(r=null==(n=t.initDataUnsafe)?void 0:n.start_param)||(r=this.getUrlParameter("startapp")),r||(r=this.getUrlParameter("tgWebAppStartParam")),!r){e.next=28;break}if(a=r.replace("refId",""),!(o=null==(s=this.userId)?void 0:s.toString())||!a||o===a){e.next=28;break}return e.prev=8,e.next=11,fetch("https://misapat.ru/api/referrals?referrer_id="+a+"&referral_id="+o,{method:"POST",headers:{"Content-Type":"application/json"}});case 11:if(!(c=e.sent).ok){e.next=18;break}return e.next=15,c.json();case 15:e.sent,e.next=23;break;case 18:return e.next=20,c.json();case 20:u=e.sent,"Такая запись о реферале уже существует"===(l=null==u?void 0:u.message)||console.error("Ошибка при регистрации реферала:",l);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(8),console.error("Ошибка при регистрации реферала:",e.t0);case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(0),console.error("Ошибка в методе startApp:",e.t1);case 33:case"end":return e.stop()}}),e,this,[[0,30],[8,25]])})));return function(t){return e.apply(this,arguments)}}(),c.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))},c.useMockData=function(){var e={id:121121121,username:"121 guy",first_name:"madesta121",last_name:"",language_code:"en",is_premium:!1,photo_url:"",full_name:"Test User"};this.userId=e.id,this.username=e.username,this.userData=e,this.initialized=!0,this.eventTarget.emit("userInitialized")},c.createOrUpdateUser=function(){var e=o(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new URLSearchParams({id:t.id.toString(),username:t.username||"",first_name:t.first_name||"",last_name:t.last_name||""}),e.next=4,fetch("https://misapat.ru/api/users?"+n.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 4:if((r=e.sent).ok){e.next=7;break}throw new Error("Ошибка при отправке POST запроса: "+r.statusText);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("Ошибка при создании или обновлении пользователя.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),c.autoConnect=function(){var e=this;try{this.socket=io("https://misapat.ru",{transports:["websocket"],secure:!0,rejectUnauthorized:!1}),this.socket.on("connect",(function(){e.socket.emit("register",{userId:e.userId}),e.showUserInfo(!0)})),this.socket.on("disconnect",(function(){e.showMessage("Отключено от сервера.","danger"),e.showUserInfo(!1),console.warn("Socket отключен от сервера.")})),this.socket.on("energyUpdated",(function(t){void 0!==t.energy_left?e.updateEnergy(Math.round(t.energy_left)):console.warn("energyUpdated event received, but energy_left is undefined.")})),this.socket.on("boostsUpdated",(function(t){void 0!==t.boosts_left?e.updateBoosts(t.boosts_left):console.warn("boostsUpdated event received, but boosts_left is undefined.")})),this.socket.on("coinsUpdated",(function(t){void 0!==t.coins?(e.updateCoins(Math.round(t.coins)),e.eventTarget.emit("coinsUpdatedExternally",e.currentCoins)):console.warn("coinsUpdated event received, but coins is undefined.")})),this.socket.on("tapError",(function(t){e.showMessage(t.message,"warning"),console.warn("tapError:",t.message)})),this.socket.on("registrationError",(function(t){e.showMessage(t.message,"danger"),e.showUserInfo(!1),console.error("registrationError:",t.message)})),this.socket.on("connect_error",(function(t){e.showMessage("Ошибка подключения к серверу.","danger"),console.error("connect_error:",t)})),this.socket.on("boostActivated",(function(t){void 0!==t.newEnergyValue&&e.updateEnergy(Math.round(t.newEnergyValue))})),this.socket.on("boostError",(function(t){console.error("Ошибка активации буста:",t.message),e.showMessage("Ошибка буста: "+t.message,"danger")}))}catch(e){this.showMessage("Ошибка подключения к серверу.","danger"),console.error("Socket connection error:",e)}},c.fetchInitialData=function(){var e=o(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://misapat.ru/api/users/"+this.userId);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: "+t.status);case 6:return e.next=8,t.json();case 8:return(n=e.sent).created_at?this.registrationDate=n.created_at:console.warn("Дата регистрации не найдена в ответе API."),void 0!==n.energy_left?this.updateEnergy(Math.round(n.energy_left)):console.warn("Energy data not found in API response."),void 0!==n.boosts_left?this.updateBoosts(n.boosts_left):console.warn("Boosts data not found in API response."),e.next=14,this.fetchTotalCoins();case 14:return e.next=16,this.fetchPassiveIncomePerHour();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error fetching initial data:",e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),c.getRegistrationDate=function(){return this.registrationDate},c.fetchTotalCoins=function(){var e=o(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://misapat.ru/api/totalCoins/"+this.userId);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: "+t.status);case 6:return e.next=8,t.json();case 8:void 0!==(n=e.sent).coins?this.updateCoins(Math.round(n.coins)):console.warn("Coins data not found in API response."),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn("Ошибка при получении количества монет. Используем значение по умолчанию 0.",e.t0),this.updateCoins(0);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),c.getCurrentCoins=function(){return this.currentCoins},c.updateCoins=function(e){this.currentCoins=e,this.coinsLabel?this.coinsLabel.string=this.currentCoins.toLocaleString():console.warn("coinsLabel не назначен в SocketManager."),this.eventTarget.emit("coinsUpdatedExternally",this.currentCoins)},c.formatNumber=function(e){return e>=1e6?(e/1e6).toFixed(1).replace(".0","")+"M":e>=1e3?(e/1e3).toFixed(1).replace(".0","")+"k":e.toString()},c.fetchPassiveIncomePerHour=function(){var e=o(i().mark((function e(){var t,n,r,s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://misapat.ru/api/passiveIncome/perHour?userId="+this.userId);case 3:if((t=e.sent).ok){e.next=9;break}return e.next=7,t.text();case 7:throw n=e.sent,new Error("HTTP error! status: "+t.status+", response: "+n);case 9:return e.next=11,t.json();case 11:"passive_income_per_hour"in(r=e.sent)?(s=Math.round(r.passive_income_per_hour),this.passiveIncomePerHourLabel&&(a=this.formatNumber(s),this.passiveIncomePerHourLabel.string="+ "+a+" в час"),this.eventTarget.emit("passiveIncomeUpdated",s)):console.warn("Неизвестный формат ответа от сервера:",r),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Ошибка при получении пассивного дохода в час:",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),c.updateBoosts=function(e){this.currentBoosts=e,this.boostsLabel?this.boostsLabel.string=this.currentBoosts+"/"+this.maxBoosts:console.warn("boostsLabel не назначен в SocketManager.")},c.updateEnergy=function(e){e=Math.max(0,Math.min(this.maxEnergy,e)),this.currentEnergy=e;var t=e/this.maxEnergy;this.energyProgressBar.progress=t,this.energyValueLabel.string=e+"/"+this.maxEnergy},c.showUserInfo=function(e){this.coinsLabel&&this.energyProgressBar&&this.energyValueLabel&&this.boostsLabel&&this.passiveIncomePerHourLabel&&(this.coinsLabel.node.active=e,this.energyProgressBar.node.active=e,this.energyValueLabel.node.active=e,this.boostsLabel.node.active=e,this.passiveIncomePerHourLabel.node.active=e)},c.showMessage=function(e,t){if(void 0===t&&(t="info"),this.messagesLabel)switch(this.messagesLabel.string=e,t){case"success":this.messagesLabel.node.color=new d(0,255,0);break;case"danger":this.messagesLabel.node.color=new d(255,0,0);break;case"warning":this.messagesLabel.node.color=new d(255,165,0);break;default:this.messagesLabel.node.color=new d(255,255,255)}},c.getCurrentEnergy=function(){return this.currentEnergy},c.getCurrentBoosts=function(){return this.currentBoosts},c.activateBoost=function(){this.socket&&this.socket.connected&&this.userId?this.socket.emit("useBoost",{userId:this.userId}):console.error("Не удалось использовать буст: сокет не подключен или userId не установлен.")},c.onTap=function(){var e=o(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userId){e.next=3;break}return this.showMessage("Пользователь не подключен.","danger"),e.abrupt("return");case 3:if(!(this.currentEnergy<13)){e.next=6;break}return this.showMessage("Не хватает энергии для тапа.","warning"),e.abrupt("return");case 6:this.socket&&this.socket.connected?(this.socket.emit("tap",{userId:this.userId}),this.showMessage("Тап отправлен!","info"),this.triggerHapticFeedback()):(this.showMessage("Соединение с сервером отсутствует.","danger"),console.warn("Соединение с сервером отсутствует при тапе."));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.getUserId=function(){return this.userId},c.getUsername=function(){return this.username},c.setUserId=function(e){this.userId=e,this.socket&&this.socket.connected&&this.socket.emit("register",{userId:this.userId})},c.isInitialized=function(){return this.initialized},c.emitEvent=function(e,t){this.socket&&this.socket.connected?this.socket.emit(e,t):console.error("Не удалось отправить событие "+e+": сокет не подключен.")},c.triggerHapticFeedback=function(){var e,t=null==(e=window.Telegram)?void 0:e.WebApp;t&&t.HapticFeedback?t.HapticFeedback.impactOccurred("medium"):console.warn("HapticFeedback API недоступен.")},a(t,null,[{key:"instance",get:function(){return t._instance||console.error("SocketManager не инициализирован. Убедитесь, что он добавлен на ноду в сцене."),t._instance}}]),t}(f))._instance=null,P=t((U=H).prototype,"coinsLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(U.prototype,"energyProgressBar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(U.prototype,"energyValueLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(U.prototype,"messagesLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(U.prototype,"boostsLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(U.prototype,"incomeManager",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(U.prototype,"passiveIncomeModal",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(U.prototype,"passiveIncomePerHourLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=U))||L));c._RF.pop()}}}));

System.register("chunks:///_virtual/SpineController.ts.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SocketManager.ts"],(function(e){var n,t,i,o,r,a,s,l,c,p,f,u,h,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,s=e.sp,l=e.Prefab,c=e.UITransform,p=e.Node,f=e.Vec3,u=e.instantiate,h=e.Component},function(e){g=e.SocketManager}],execute:function(){var C,m,d,S,b,v,k,w,y;r._RF.push({},"7af28zZEkNKYY1uSBPGocx/","SpineController.ts",void 0);var T=a.ccclass,P=a.property;e("SpineController",(C=T("SpineController"),m=P(s.Skeleton),d=P(g),S=P(l),C((k=n((v=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return n=e.call.apply(e,[this].concat(r))||this,i(n,"spine",k,o(n)),i(n,"socketManager",w,o(n)),i(n,"floatingTextPrefab",y,o(n)),n}t(n,e);var r=n.prototype;return r.onLoad=function(){var e=this.getComponent(c);e||(e=this.addComponent(c)),e.setContentSize(4e3,3e3),e.setAnchorPoint(.553265,.004952),this.node.on(p.EventType.TOUCH_END,this.onSpineClicked,this),this.spine?(this.spine.setAnimation(0,"Основная",!0),this.spine.setCompleteListener(this.onAnimationComplete.bind(this))):console.warn("Spine компонент не установлен в SpineController.")},r.onSpineClicked=function(e){if(this.socketManager)if(this.socketManager.getCurrentEnergy()>=13){this.spine&&(this.spine.setAnimation(1,"Нажатие",!1),this.spine.addAnimation(1,"Основная",!0,0)),this.socketManager.onTap();var n=e.getUILocation();this.spawnFloatingText(n)}else this.socketManager.showMessage("Не хватает энергии для тапа.","warning");else console.warn("SocketManager не установлен в SpineController.")},r.onAnimationComplete=function(e){e&&1===e.trackIndex&&this.spine.setAnimation(1,"Основная",!0)},r.spawnFloatingText=function(e){if(this.floatingTextPrefab){var n=this.node.scene.getChildByName("Canvas");if(n){var t=n.getComponent(c);if(t){var i=t.contentSize,o=e.x-i.width/2,r=e.y-i.height/2,a=new f(o,r,100),s=u(this.floatingTextPrefab);s.setParent(n),s.setPosition(a)}else console.warn("UITransform не найден на Canvas.")}else console.warn("Canvas не найден.")}else console.warn("floatingTextPrefab не установлен в SpineController.")},n}(h)).prototype,"spine",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=n(v.prototype,"socketManager",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=n(v.prototype,"floatingTextPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=v))||b));r._RF.pop()}}}));

System.register("chunks:///_virtual/TabBarController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,o,a,r,s,l,u,c,b,h,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,s=e.Node,l=e.Label,u=e.UIOpacity,c=e.tween,b=e.Vec3,h=e.Color,p=e.Component}],execute:function(){var d,f,g,m,v,P,T,w,y,k,x,H,z,L,F,E,C,S,B,I,N,U,R,_,A,D,O,W,G,Y,M,j,K,V,Z,q,J,Q,X,$,ee,te,ne;a._RF.push({},"40497KNIRZM96W3FB/cr0rR","TabBarController",void 0);var ie=r.ccclass,oe=r.property;e("TabBarController",(d=ie("TabBarController"),f=oe(s),g=oe(s),m=oe(s),v=oe(s),P=oe(s),T=oe(s),w=oe(s),y=oe(s),k=oe(s),x=oe(s),H=oe(l),z=oe(l),L=oe(l),F=oe(l),E=oe(l),C=oe(s),S=oe(s),B=oe(s),I=oe(s),N=oe(s),d((_=t((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,i(t,"mainPage",_,o(t)),i(t,"friendsPage",A,o(t)),i(t,"storePage",D,o(t)),i(t,"leadersPage",O,o(t)),i(t,"tasksPage",W,o(t)),i(t,"iconHome",G,o(t)),i(t,"iconFriends",Y,o(t)),i(t,"iconStore",M,o(t)),i(t,"iconLeaders",j,o(t)),i(t,"iconTasks",K,o(t)),i(t,"textHome",V,o(t)),i(t,"textFriends",Z,o(t)),i(t,"textStore",q,o(t)),i(t,"textLeaders",J,o(t)),i(t,"textTasks",Q,o(t)),i(t,"buttonHome",X,o(t)),i(t,"buttonFriends",$,o(t)),i(t,"buttonLeaders",ee,o(t)),i(t,"buttonTasks",te,o(t)),i(t,"activeButton",ne,o(t)),t.currentTab="none",t}n(t,e);var a=t.prototype;return a.onLoad=function(){var e=this;this.checkProperties(),this.showPage("home",!1),this.iconHome.on(s.EventType.TOUCH_END,(function(){e.showPage("home",!1)})),this.iconFriends.on(s.EventType.TOUCH_END,(function(){e.showPage("friends",!1)})),this.iconStore.on(s.EventType.TOUCH_END,(function(){e.showPage("store",!1)})),this.iconLeaders.on(s.EventType.TOUCH_END,(function(){e.showPage("leaders",!1)})),this.iconTasks.on(s.EventType.TOUCH_END,(function(){e.showPage("tasks",!1)}))},a.checkProperties=function(){[{name:"mainPage",value:this.mainPage},{name:"friendsPage",value:this.friendsPage},{name:"storePage",value:this.storePage},{name:"leadersPage",value:this.leadersPage},{name:"tasksPage",value:this.tasksPage},{name:"iconHome",value:this.iconHome},{name:"iconFriends",value:this.iconFriends},{name:"iconStore",value:this.iconStore},{name:"iconLeaders",value:this.iconLeaders},{name:"iconTasks",value:this.iconTasks},{name:"textHome",value:this.textHome},{name:"textFriends",value:this.textFriends},{name:"textStore",value:this.textStore},{name:"textLeaders",value:this.textLeaders},{name:"textTasks",value:this.textTasks},{name:"buttonHome",value:this.buttonHome},{name:"buttonFriends",value:this.buttonFriends},{name:"buttonLeaders",value:this.buttonLeaders},{name:"buttonTasks",value:this.buttonTasks},{name:"activeButton",value:this.activeButton}].forEach((function(e){e.value||console.warn('Property "'+e.name+'" is not assigned in the inspector.')}))},a.showPage=function(e,t){void 0===t&&(t=!0),e!==this.currentTab&&("none"!==this.currentTab&&this.hidePage(this.currentTab,t),this.showNewPage(e,t),this.updateTabUI(e),this.currentTab=e)},a.hidePage=function(e,t){var n=this.getPageNode(e);if(n){var i=n.getComponent(u);i||(console.warn('UIOpacity component not found on "'+e+'" page. Adding one.'),i=n.addComponent(u)),t?(c(n).to(.3,{scale:new b(.95,.95,1)}).start(),c(i).to(.3,{opacity:0}).call((function(){n.active=!1,n.setScale(1,1,1),i.opacity=255})).start()):(n.active=!1,i.opacity=255)}else console.error('Page node for "'+e+'" not found.')},a.showNewPage=function(e,t){var n=this.getPageNode(e);if(n){n.active=!0;var i=n.getComponent(u);i||(console.warn('UIOpacity component not found on "'+e+'" page. Adding one.'),i=n.addComponent(u)),t?(i.opacity=0,n.setScale(.95,.95,1),c(i).to(.3,{opacity:255}).start(),c(n).to(.3,{scale:new b(1.05,1.05,1)}).to(.3,{scale:new b(1,1,1)}).call((function(){})).start()):(i.opacity=255,n.setScale(1,1,1))}else console.error('Page node for "'+e+'" not found.')},a.getPageNode=function(e){switch(e){case"home":return this.mainPage;case"friends":return this.friendsPage;case"store":return this.storePage;case"leaders":return this.leadersPage;case"tasks":return this.tasksPage;default:return console.warn("Unknown page: "+e),null}},a.updateTabUI=function(e){switch(this.textHome.color=h.GRAY,this.textFriends.color=h.GRAY,this.textStore.color=h.GRAY,this.textLeaders.color=h.GRAY,this.textTasks.color=h.GRAY,this.activeButton.active=!1,this.buttonHome.active=!1,this.buttonFriends.active=!1,this.buttonLeaders.active=!1,this.buttonTasks.active=!1,e){case"home":this.textHome.color=h.WHITE,this.buttonHome.active=!0;break;case"friends":this.textFriends.color=h.WHITE,this.buttonFriends.active=!0;break;case"store":this.textStore.color=h.WHITE,this.activeButton.active=!0;break;case"leaders":this.textLeaders.color=h.WHITE,this.buttonLeaders.active=!0;break;case"tasks":this.textTasks.color=h.WHITE,this.buttonTasks.active=!0}},t}(p)).prototype,"mainPage",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(R.prototype,"friendsPage",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(R.prototype,"storePage",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(R.prototype,"leadersPage",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(R.prototype,"tasksPage",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(R.prototype,"iconHome",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(R.prototype,"iconFriends",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(R.prototype,"iconStore",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(R.prototype,"iconLeaders",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(R.prototype,"iconTasks",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(R.prototype,"textHome",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(R.prototype,"textFriends",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(R.prototype,"textStore",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(R.prototype,"textLeaders",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(R.prototype,"textTasks",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(R.prototype,"buttonHome",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(R.prototype,"buttonFriends",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(R.prototype,"buttonLeaders",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(R.prototype,"buttonTasks",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(R.prototype,"activeButton",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=R))||U));a._RF.pop()}}}));

System.register("chunks:///_virtual/Telegram.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"7de8aOSxIpO95DB2tvaKgVA","Telegram",void 0),e("TelegramWebApp",function(){function e(){this.tg=null}var n=e.prototype;return n.loadSDK=function(){var e=this;return new Promise((function(t,n){var r;if(null!=(r=window.Telegram)&&r.WebApp)return e.tg=window.Telegram.WebApp,void t();var i=document.createElement("script");i.src="https://telegram.org/js/telegram-web-app.js",i.onload=function(){e.tg=window.Telegram.WebApp,t()},i.onerror=function(){n(new Error("Не удалось загрузить Telegram Web Apps SDK."))},document.head.appendChild(i)}))},n.initialize=function(e){var t;if(this.tg){var n,r,i,l,o,a,s,c,u;if(null!=e&&e.expand)null==(n=(r=this.tg).expand)||n.call(r);if(null!=e&&e.disableVerticalSwipes)null==(i=(l=this.tg).disableVerticalSwipes)||i.call(l),this.tg.isVerticalSwipesEnabled=!1;if(null!=e&&e.backgroundColor)null==(o=(a=this.tg).setBackgroundColor)||o.call(a,e.backgroundColor);if(null!=e&&e.headerColor)null==(s=(c=this.tg).setHeaderColor)||s.call(c,e.headerColor);if(null!=(t=this.tg)&&t.web_app_setup_swipe_behavior)this.tg.web_app_setup_swipe_behavior({allow_vertical_swipe:null==(u=null==e?void 0:e.disableVerticalSwipes)||u})}else console.warn("Telegram WebApp SDK не загружен.")},n.ready=function(){var e=this;return new Promise((function(t){e.tg?(e.tg.ready(),t()):t()}))},n.setBackgroundColor=function(e){this.tg&&this.tg.setBackgroundColor?this.tg.setBackgroundColor(e):console.warn("Метод setBackgroundColor недоступен.")},n.setHeaderColor=function(e){this.tg&&this.tg.setHeaderColor?this.tg.setHeaderColor(e):console.warn("Метод setHeaderColor недоступен.")},n.triggerHapticFeedback=function(e){void 0===e&&(e="medium"),this.tg&&this.tg.HapticFeedback?this.tg.HapticFeedback.impactOccurred(e):console.warn("HapticFeedback API недоступен.")},t(e,null,[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/UnlockedModalCard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n,t,o,i,a,l,c,u,d,p,s;return{setters:[function(e){r=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,l=e.Label,c=e.Sprite,u=e.Button,d=e.resources,p=e.SpriteFrame,s=e.Component}],execute:function(){var f,b,y,m,h,C,v,D,S;i._RF.push({},"336f9EjZc9HTY4IMBl4Ozro","UnlockedModalCard",void 0);var g=a.ccclass,k=a.property;e("UnlockedModalCard",(f=g("UnlockedModalCard"),b=k(l),y=k(c),m=k(u),f((v=r((C=function(e){function r(){for(var r,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return r=e.call.apply(e,[this].concat(i))||this,t(r,"numberOfDayLabel",v,o(r)),t(r,"iconSprite",D,o(r)),t(r,"openCardButton",S,o(r)),r}n(r,e);var i=r.prototype;return i.setDayNumber=function(e,r){void 0===r&&(r="День "),this.numberOfDayLabel?this.numberOfDayLabel.string=""+r+e:console.warn("UnlockedModalCard: numberOfDayLabel не назначен.")},i.setCardData=function(e){var r;this.setDayNumber(e.day),null!=(r=e.card)&&r.image_url?this.loadSpriteFrame(e.card.image_url):(console.warn("UnlockedModalCard: Отсутствует image_url для карточки дня "+e.day),this.iconSprite.node.active=!1)},i.loadSpriteFrame=function(e){var r=this;d.load(e,p,(function(e,n){if(e)return console.error("UnlockedModalCard: Ошибка при загрузке SpriteFrame: "+e),void(r.iconSprite.node.active=!1);r.iconSprite.spriteFrame=n,r.iconSprite.node.active=!0}))},i.onDestroy=function(){this.openCardButton&&this.openCardButton.node.off(u.EventType.CLICK,this.onOpenCardClicked,this)},r}(s)).prototype,"numberOfDayLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=r(C.prototype,"iconSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=r(C.prototype,"openCardButton",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=C))||h));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});